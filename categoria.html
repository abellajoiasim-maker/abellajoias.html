<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Categoria | Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{background:#F8F6F2}
.gold{color:#A68966}
.font-serif{font-family:'Cinzel',serif}
.floating{position:fixed;bottom:20px;right:20px;z-index:50}
</style>
</head>

<body class="p-6">

<h1 id="titulo" class="font-serif text-2xl gold text-center mb-6"></h1>

<div id="produtos" class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-6xl mx-auto"></div>

<!-- BotÃµes flutuantes -->
<div class="floating flex flex-col gap-3">
  <button onclick="history.back()" class="bg-gray-700 text-white px-4 py-3 rounded-full text-sm">ðŸ”™ Voltar</button>
  <a href="cart_checkout_premium.html" class="bg-black text-white px-4 py-3 rounded-full text-sm">ðŸ›’ Carrinho</a>
  <a href="galvanicas.html" class="bg-gold text-white px-4 py-3 rounded-full text-sm" style="background:#A68966">âœ¨ GalvÃ¢nicas</a>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias"
});
const db=firebase.database();

const cat=new URLSearchParams(location.search).get('cat');
titulo.textContent=cat;

db.ref('settings').once('value').then(cfg=>{
  const pix=cfg.val()?.pix||0;
  const parcelas=cfg.val()?.parcelas||1;

  db.ref('products').orderByChild('sku').on('value',snap=>{
    produtos.innerHTML='';
    snap.forEach(s=>{
      const p=s.val();
      if(p.category!==cat) return;

      const valorPix=(p.price*(1-pix/100)).toFixed(2);

      produtos.innerHTML+=`
      <div class="bg-white border p-3">
        <img src="${p.image}" class="w-full aspect-square object-contain mb-2">
        <p class="text-sm font-semibold">${p.name}</p>
        <p class="text-xs text-gray-500">SKU ${p.sku}</p>

        <p class="mt-1">Valor: <strong>R$ ${p.price.toFixed(2)}</strong></p>
        <p class="text-green-700 text-sm">Pix: R$ ${valorPix}</p>
        <p class="text-xs">${parcelas}x sem acrÃ©scimo</p>

        <button onclick='addCart(${JSON.stringify(p)})'
          class="mt-2 bg-black text-white w-full py-2 text-xs">
          ADICIONAR AO CARRINHO
        </button>
      </div>`;
    });
  });
});

function addCart(p){
  let cart=JSON.parse(localStorage.getItem('cart')||'[]');
  const i=cart.find(i=>i.sku===p.sku);
  i ? i.qty++ : cart.push({...p,qty:1});
  localStorage.setItem('cart',JSON.stringify(cart));
  alert('Produto adicionado ao carrinho');
}
</script>

</body>
</html>
