<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Produtos | Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Poppins:wght@300;500&display=swap" rel="stylesheet">

<style>
body{font-family:Poppins;background:#f8f6f2}
.serif{font-family:Cinzel}
.gold{color:#A68966}
.card{background:white;border-radius:16px}
</style>
</head>

<body>

<header class="p-6 flex justify-between items-center border-b bg-white">
  <a href="index.html" class="text-sm text-gray-500">← VOLTAR</a>
  <h1 class="serif gold text-lg" id="tituloCat"></h1>
  <button onclick="abrirCarrinho()" class="bg-black text-white px-4 py-2 rounded-full text-xs">CARRINHO</button>
</header>

<main class="max-w-6xl mx-auto p-6 grid grid-cols-2 md:grid-cols-4 gap-6" id="produtos"></main>

<!-- CARRINHO -->
<div id="carrinho" class="fixed inset-0 bg-black/50 hidden items-center justify-center">
  <div class="bg-white w-full max-w-lg rounded-xl p-6">
    <h2 class="font-bold mb-4">Carrinho</h2>
    <div id="itens"></div>
    <div class="mt-4 flex justify-between">
      <button onclick="fecharCarrinho()" class="text-gray-500">Voltar às compras</button>
      <a href="checkout.html" class="bg-black text-white px-4 py-2 rounded-full">Finalizar</a>
    </div>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  databaseURL:"https://catalogo-abella-joias-default-rtdb.firebaseio.com"
});
const db=firebase.database();
const cat=new URLSearchParams(location.search).get('cat');
tituloCat.innerText=cat;

let cart=[];

db.ref('produtos').orderByChild('categoria').equalTo(cat).on('value',snap=>{
produtos.innerHTML='';
snap.forEach(s=>{
const p=s.val();
const promo=p.preco*(1-(p.promo||0)/100);
produtos.innerHTML+=`
<div class="card p-3 shadow">
<img src="${p.img}" class="w-full aspect-square object-contain">
<h3 class="text-sm font-semibold mt-2">${p.nome}</h3>
<p class="text-xs line-through text-gray-400">R$ ${p.preco.toFixed(2)}</p>
<p class="gold font-bold">R$ ${promo.toFixed(2)}</p>
<button onclick="add('${p.nome}',${promo})" class="mt-2 w-full bg-black text-white py-2 text-xs rounded-full">ADICIONAR</button>
</div>`;
});
});

function add(nome,preco){
const q=Number(prompt('Quantidade'));
if(q>0) cart.push({nome,preco,q});
}

function abrirCarrinho(){
itens.innerHTML='';
cart.forEach(i=>{
itens.innerHTML+=`<p>${i.q}x ${i.nome}</p>`;
});
carrinho.classList.remove('hidden');carrinho.classList.add('flex');
}
function fecharCarrinho(){carrinho.classList.add('hidden')}
</script>

</body>
</html>
