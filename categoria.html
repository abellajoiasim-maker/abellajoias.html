<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Categoria | Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{background:#F8F6F2}
.gold{color:#A68966}
.float{
 position:fixed;right:20px;padding:12px 16px;
 background:#000;color:#fff;border-radius:999px;
 font-size:12px;z-index:50
}
#btnVoltar{bottom:80px}
#btnCarrinho{bottom:20px}
#btnGalv{bottom:140px}
</style>
</head>

<body class="p-6 max-w-7xl mx-auto">

<h1 id="tituloCat" class="font-serif text-3xl gold mb-8"></h1>

<div id="listaProdutos"
 class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
</div>

<a href="index.html" id="btnVoltar" class="float">Voltar</a>
<a href="cart_checkout_premium.html" id="btnCarrinho" class="float">Carrinho</a>
<a href="galvanicas.html" id="btnGalv" class="float">Galvânicas</a>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias"
});
const db=firebase.database();

const params=new URLSearchParams(location.search);
const catId=params.get('cat');

let settings={};
db.ref('settings').once('value').then(s=>settings=s.val());

db.ref('categories/'+catId).once('value')
.then(s=>tituloCat.textContent=s.val().name);

db.ref('products')
.orderByChild('sku')
.on('value',snap=>{
  listaProdutos.innerHTML='';
  snap.forEach(s=>{
    const p=s.val();
    if(p.category!==catId) return;

    const desconto=settings.pix||0;
    const valorPix=p.price*(1-desconto/100);
    const parcelas=settings.parcelas||1;

    listaProdutos.innerHTML+=`
      <div class="bg-white border rounded p-3">
        <img src="${p.image}"
         class="aspect-square object-cover w-full mb-2">
        <strong>${p.name}</strong>
        <p class="text-xs text-gray-500">${p.sku}</p>

        <p class="mt-1">
          <span class="line-through text-xs text-gray-400">
            R$ ${p.price.toFixed(2)}
          </span><br>
          <span class="gold font-semibold">
            PIX: R$ ${valorPix.toFixed(2)}
          </span><br>
          <span class="text-xs">
            ${parcelas}x sem acréscimo
          </span>
        </p>

        <button onclick='addCarrinho(${JSON.stringify(p)})'
         class="bg-black text-white w-full mt-3 py-2 text-xs">
         Adicionar ao Carrinho
        </button>
      </div>`;
  });
});

function addCarrinho(p){
  let cart=JSON.parse(localStorage.getItem('cart')||'[]');
  const i=cart.find(x=>x.sku===p.sku);
  if(i) i.qty++;
  else cart.push({...p,qty:1});
  localStorage.setItem('cart',JSON.stringify(cart));
  alert('Produto adicionado ao carrinho');
}
</script>

</body>
</html>
