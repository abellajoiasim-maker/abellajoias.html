<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luary Shop | Chaveiros Temáticos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --navy: #1a2a3a; --accent: #d4af37; --bg: #fcfcfc; }
        body { font-family: 'Montserrat', sans-serif; background: var(--bg); color: var(--navy); }
        .serif { font-family: 'Playfair Display', serif; }
        
        .card-luary { background: #fff; border-radius: 20px; border: 1px solid #f0f0f0; transition: all 0.3s ease; overflow: hidden; display: flex; flex-direction: column; position: relative; }
        
        /* Ajuste do Carrossel */
        .carousel-container { width: 100%; aspect-ratio: 1/1; overflow-x: scroll; display: flex; scroll-snap-type: x mandatory; scrollbar-width: none; background: #fff; }
        .carousel-container::-webkit-scrollbar { display: none; }
        .carousel-item { min-width: 100%; scroll-snap-align: start; padding: 10px; }
        .carousel-item img { width: 100%; height: 100%; object-fit: contain; border-radius: 15px; }
        
        .indicator { position: absolute; bottom: 170px; left: 50%; transform: translateX(-50%); display: flex; gap: 4px; }
        .dot { width: 6px; height: 6px; background: rgba(0,0,0,0.2); border-radius: 50%; }

        .btn-add { background: var(--navy); color: #fff; width: 100%; padding: 14px; border-radius: 12px; font-size: 12px; font-weight: 600; text-transform: uppercase; transition: 0.3s; margin-top: auto; }
        .btn-add:hover { background: var(--accent); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body>

<header class="bg-white border-b border-gray-100 p-6 text-center sticky top-0 z-50">
    <h1 class="serif text-4xl cursor-pointer" onclick="carregarInicio()">LUARY <span class="text-[#d4af37]">SHOP</span></h1>
    <div class="flex justify-center gap-8 mt-4">
        <button onclick="carregarInicio()" class="text-[11px] font-bold uppercase hover:text-[#d4af37]">Coleções</button>
        <a href="carrinho.html" class="text-[11px] font-bold uppercase text-[#d4af37]">Carrinho (<span id="cart-total">R$ 0,00</span>)</a>
    </div>
</header>

<main class="max-w-7xl mx-auto p-6 md:p-10">
    <div id="grid-content" class="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-10"></div>
</main>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyD62Yef2ggoAFSc-qKPlBTaRPRn20D91ug",
        databaseURL: "https://luary-shop-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let configLoja = {};

    // Função auxiliar para formatar moeda
    const fM = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

    function carregarConfig() {
        db.ref('settings').on('value', snap => {
            configLoja = snap.val() || {};
            carregarInicio();
            atualizarTotalCarrinho();
        });
    }

    function carregarInicio() {
        const grid = document.getElementById('grid-content');
        grid.classList.remove('grid-cols-1');
        grid.classList.add('grid-cols-2', 'md:grid-cols-4');
        
        db.ref('categories').on('value', snap => {
            grid.innerHTML = '';
            snap.forEach(s => {
                const cat = s.val();
                grid.innerHTML += `
                    <div class="card-luary cursor-pointer group" onclick="verProdutos('${s.key}', '${cat.name}')">
                        <div class="carousel-item"><img src="${cat.image || 'https://via.placeholder.com/500'}"></div>
                        <div class="p-6 text-center"><h3 class="serif text-xl">${cat.name}</h3></div>
                    </div>`;
            });
        });
    }

    function exibirDetalhesProduto(p) {
        window.scrollTo({top: 0, behavior: 'smooth'});
        const grid = document.getElementById('grid-content');
        
        grid.classList.remove('grid-cols-2', 'md:grid-cols-4');
        grid.classList.add('grid-cols-1'); 
        
        grid.innerHTML = `
            <button onclick="carregarInicio()" class="mb-4 text-sm text-gray-500 hover:text-navy flex items-center gap-2">
                <i class="fas fa-arrow-left"></i> Voltar para a loja
            </button>
            <div class="flex flex-col md:flex-row gap-8 bg-white p-4 animate-fadeIn">
                <div class="flex flex-row gap-4 md:w-1/2">
                    <div class="flex flex-col gap-2 w-16">
                        <img src="${p.image}" class="border border-[#d4af37] rounded p-1 cursor-pointer">
                    </div>
                    <div class="flex-1">
                        <img src="${p.image}" class="w-full object-contain max-h-[500px]" id="main-img">
                    </div>
                </div>

                <div class="flex-1 border-b md:border-b-0 pb-6">
                    <h1 class="text-2xl font-medium leading-tight mb-1 text-navy">${p.name}</h1>
                    <p class="text-sm text-blue-600 hover:underline cursor-pointer mb-2 italic">Visite a loja Abella Joias</p>
                    <div class="flex items-center gap-1 mb-4 text-[#FFA41C]">
                        <span class="text-sm font-bold">4.8</span> <span>★★★★★</span>
                        <span class="text-blue-600 text-sm ml-2 underline">128 avaliações</span>
                    </div>
                    <hr class="my-4">
                    
                    <div class="flex items-baseline gap-2">
                        <span class="text-red-600 text-2xl font-light">-${p.promoPct || 0}%</span>
                        <span class="text-3xl font-semibold">${fM(p.price)}</span>
                    </div>
                    <p class="text-gray-500 text-xs uppercase mb-4">De: <span class="line-through">${fM(p.price * 1.25)}</span></p>

                    <div class="flex items-center gap-2 bg-orange-50 border border-orange-200 p-2 rounded w-fit mb-6">
                        <input type="checkbox" class="w-4 h-4 accent-orange-600">
                        <span class="text-sm">Aplicar cupom de <span class="font-bold text-green-700">R$ 5,00</span></span>
                    </div>

                    <h3 class="font-bold text-sm mb-2">Sobre este item:</h3>
                    <ul class="list-disc ml-5 text-sm space-y-1 text-gray-800">
                        <li>Alta qualidade e acabamento Premium.</li>
                        <li>Design exclusivo Luary Shop.</li>
                        <li>Ideal para presentear quem você ama.</li>
                    </ul>
                </div>

                <div class="w-full md:w-[260px] border border-gray-300 rounded-xl p-4 shadow-sm h-fit">
                    <div class="text-2xl font-medium mb-1">${fM(p.price)}</div>
                    <p class="text-sm text-green-700 font-bold mb-4 italic">Entrega GRÁTIS disponível</p>
                    <p class="text-sm mb-1">Entrega <span class="font-bold">2 a 5 dias úteis</span></p>
                    <div class="text-lg text-green-600 font-bold mb-4">Em estoque.</div>
                    <button onclick='addCart(${JSON.stringify(p)})' class="w-full bg-[#FFD814] hover:bg-[#F7CA00] py-2 rounded-full mb-2 text-sm shadow-sm transition">Adicionar ao Carrinho</button>
                    <button class="w-full bg-[#FFA41C] hover:bg-[#FA8914] py-2 rounded-full text-sm shadow-sm transition font-medium">Comprar agora</button>
                </div>
            </div>`;
    }

    function verProdutos(catId, catName) {
        db.ref('products').once('value', snap => {
            const grid = document.getElementById('grid-content');
            grid.innerHTML = '';
            const promoAtiva = configLoja.promocoes?.ativa || false;

            snap.forEach(s => {
                const p = s.val();
                if(p.category === catId) {
                    db.ref(`categories/${catId}`).once('value', catSnap => {
                        const catData = catSnap.val() || {};
                        let desconto = promoAtiva ? (p.promoPct || catData.promoPct || 0) : 0;
                        const precoComDesconto = p.price * (1 - (desconto/100));

                        grid.innerHTML += `
                            <div class="card-luary p-4 cursor-pointer" onclick='exibirDetalhesProduto(${JSON.stringify({...p, price: precoComDesconto, id: s.key})})'>
                                <div class="carousel-container">
                                    <div class="carousel-item"><img src="${p.image}"></div>
                                </div>
                                <div class="flex-1 mt-2 px-1 text-center">
                                    <h3 class="text-[11px] font-bold uppercase h-8 overflow-hidden text-navy">${p.name}</h3>
                                    <div class="text-xl font-black text-navy mt-2">${fM(precoComDesconto)}</div>
                                </div>
                                <button class="btn-add mt-4">Ver Detalhes</button>
                            </div>`;
                    });
                }
            });
        });
    }

    function addCart(p) {
        let cart = JSON.parse(localStorage.getItem('luary_cart') || '[]');
        cart.push(p);
        localStorage.setItem('luary_cart', JSON.stringify(cart));
        atualizarTotalCarrinho();
        alert("Adicionado ao carrinho!");
    }

    function atualizarTotalCarrinho() {
        const cart = JSON.parse(localStorage.getItem('luary_cart') || '[]');
        const total = cart.reduce((acc, item) => acc + parseFloat(item.price), 0);
        document.getElementById('cart-total').innerText = fM(total);
    }

    window.onload = carregarConfig;
</script>
</body>
</html>
