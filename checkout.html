<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checkout | Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>

<body class="bg-neutral-50 max-w-xl mx-auto p-4">

<h1 class="text-xl font-serif text-center mb-4">Finalizar Pedido</h1>

<input id="cliente" placeholder="Nome do cliente"
  class="border p-3 w-full mb-3">

<input id="whats" placeholder="WhatsApp (somente n√∫meros)"
  class="border p-3 w-full mb-4">

<select id="pagamento" class="border p-3 w-full mb-4">
  <option value="PIX">PIX</option>
  <option value="CARTAO">Cart√£o</option>
</select>

<div id="resumo" class="bg-white border p-4 mb-4 text-sm"></div>

<p class="text-right font-semibold">
  Peso total: <span id="peso">0</span> g
</p>

<p class="text-right font-semibold text-lg">
  Total: R$ <span id="total">0.00</span>
</p>

<button onclick="finalizar()"
  class="bg-black text-white w-full py-4 mt-4">
ENVIAR PEDIDO NO WHATSAPP
</button>

<script>
/* üî• FIREBASE ‚Äî USAR O MESMO DO PAINEL */
firebase.initializeApp({
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_PROJETO.firebaseapp.com",
  databaseURL: "https://SEU_PROJETO-default-rtdb.firebaseio.com",
  projectId: "SEU_PROJETO"
});

const db = firebase.database();

const cart = JSON.parse(localStorage.getItem("cart")) || [];
const resumo = document.getElementById("resumo");
const totalEl = document.getElementById("total");
const pesoEl = document.getElementById("peso");

let total = 0;
let pesoTotal = 0;

render();

/* RESUMO */
function render(){
  resumo.innerHTML="";
  total = 0;
  pesoTotal = 0;

  cart.forEach(i=>{
    const sub = i.price * i.qty;
    const peso = (i.weight || 0) * i.qty;

    total += sub;
    pesoTotal += peso;

    resumo.innerHTML += `
      <p>${i.qty}x ${i.name}</p>
      <p class="text-xs text-gray-400">
        Peso unit√°rio: ${i.weight || 0}g
      </p>
      <p class="mb-2">Subtotal: R$ ${sub.toFixed(2)}</p>
      <hr class="mb-2">
    `;
  });

  totalEl.textContent = total.toFixed(2);
  pesoEl.textContent = pesoTotal;
}

/* FINALIZAR */
function finalizar(){
  if(cart.length === 0) return alert("Carrinho vazio");

  const nome = cliente.value.trim();
  const whats = whatsInput.value;

  if(!nome || !whats) return alert("Preencha nome e WhatsApp");

  const pagamento = document.getElementById("pagamento").value;

  const pedido = {
    cliente: nome,
    customer: nome,
    whatsapp: whats,
    data: new Date().toLocaleString("pt-BR"),
    status: "Novo",
    pagamento,
    total,
    pesoTotal,
    itens: cart.map(i=>({
      nome: i.name,
      sku: i.sku,
      qtd: i.qty,
      peso: i.weight || 0,
      valor: i.price
    }))
  };

  db.ref("orders").push(pedido);

  /* WHATSAPP */
  let msg = `üõçÔ∏è *Pedido Abella Joias*%0A%0A`;
  cart.forEach(i=>{
    msg += `${i.qty}x ${i.name} ‚Äî ${i.weight||0}g%0A`;
  });
  msg += `%0A‚öñÔ∏è Peso total: ${pesoTotal}g`;
  msg += `%0Aüí≥ Pagamento: ${pagamento}`;
  msg += `%0Aüí∞ Total: R$ ${total.toFixed(2)}`;

  localStorage.removeItem("cart");
  window.open(`https://wa.me/55${whats}?text=${msg}`);
}
</script>

</body>
</html>
