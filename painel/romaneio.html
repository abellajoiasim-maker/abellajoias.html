<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Romaneio | Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
  body { background:#f8f6f2; }
  .gold { color:#A68966 }
  .print-hidden { display:none }
  @media print {
    .no-print { display:none }
    body { background:#fff }
  }
</style>
</head>

<body class="p-8">

<!-- TOPO -->
<div class="flex justify-between items-center border-b pb-4 mb-6">
  <div>
    <h1 class="text-2xl font-serif gold">Romaneio de Pedido</h1>
    <p class="text-xs text-gray-500">Abella Joias</p>
  </div>

  <div class="flex gap-3 no-print">
    <button onclick="toggleFotos()"
      class="border px-4 py-2 text-xs rounded">
      ðŸ“¸ Fotos
    </button>

    <button onclick="window.print()"
      class="bg-black text-white px-5 py-2 text-xs rounded">
      ðŸ–¨ Gerar PDF
    </button>
  </div>
</div>

<!-- DADOS CLIENTE -->
<section class="mb-8">
  <h2 class="font-bold gold mb-2">Dados do Cliente</h2>
  <div class="grid md:grid-cols-3 gap-4 bg-white p-4 border rounded">
    <input id="cNome" placeholder="Nome do cliente" class="border p-2">
    <input id="cTelefone" placeholder="Telefone / WhatsApp" class="border p-2">
    <input id="cPagamento" placeholder="Forma de pagamento" class="border p-2">

    <input id="cLocal" placeholder="Local de entrega" class="border p-2 md:col-span-3">
    <input id="cEndereco" placeholder="EndereÃ§o completo" class="border p-2 md:col-span-3">
    <input id="cCidade" placeholder="Cidade" class="border p-2">
  </div>
</section>

<!-- LISTA DE ITENS -->
<section>
  <h2 class="font-bold gold mb-2">Itens do Pedido</h2>

  <table class="w-full bg-white border text-xs">
    <thead class="bg-gray-100 text-left">
      <tr>
        <th class="p-2">SKU</th>
        <th class="p-2">Produto</th>
        <th class="p-2">Peso (g)</th>
        <th class="p-2">Valor</th>
        <th class="p-2">Qtd</th>
        <th class="p-2">Total</th>
      </tr>
    </thead>
    <tbody id="listaItens"></tbody>
  </table>
</section>

<!-- TOTAIS -->
<section class="mt-6 max-w-md ml-auto">
  <div class="bg-white border p-4 text-sm space-y-1">
    <p>Peso total: <strong><span id="pesoTotal">0</span> g</strong></p>
    <p>Valor bruto: <strong>R$ <span id="valorBruto">0.00</span></strong></p>
    <p class="text-green-700">Desconto PIX: <strong>R$ <span id="valorPix">0.00</span></strong></p>
    <hr>
    <p class="text-lg">Valor final: 
      <strong class="gold">R$ <span id="valorFinal">0.00</span></strong>
    </p>
  </div>
</section>

<!-- RODAPÃ‰ -->
<div class="mt-10 text-center text-[10px] text-gray-400">
  Documento interno â€¢ Abella Joias â€¢ Uso administrativo
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias"
});
const db = firebase.database();

/* UTIL */
const params = new URLSearchParams(location.search);
const pedidoId = params.get("id");

let mostrarFotos = false;
function toggleFotos(){
  mostrarFotos = !mostrarFotos;
  document.querySelectorAll(".foto").forEach(f => {
    f.style.display = mostrarFotos ? "block" : "none";
  });
}

/* CARREGAR PEDIDO */
db.ref("pedidos/" + pedidoId).once("value").then(snap => {
  const p = snap.val();
  if(!p) return;

  cNome.value = p.cliente?.nome || "";
  cTelefone.value = p.cliente?.telefone || "";
  cPagamento.value = p.pagamento || "";
  cEndereco.value = p.entrega?.endereco || "";
  cCidade.value = p.entrega?.cidade || "";
  cLocal.value = p.entrega?.local || "";

  let peso = 0, bruto = 0;

  p.itens.forEach(i => {
    const total = i.preco * i.qtd;
    peso += (i.peso||0) * i.qtd;
    bruto += total;

    listaItens.innerHTML += `
      <tr class="border-t">
        <td class="p-2">${i.sku}</td>
        <td class="p-2">
          ${i.nome}
          <img src="${i.imagem||''}" class="foto mt-2 w-16 hidden">
        </td>
        <td class="p-2">${i.peso||0}</td>
        <td class="p-2">R$ ${i.preco.toFixed(2)}</td>
        <td class="p-2">${i.qtd}</td>
        <td class="p-2">R$ ${total.toFixed(2)}</td>
      </tr>`;
  });

  const descontoPix = bruto * ((p.descontoPix||0)/100);
  const final = bruto - descontoPix;

  pesoTotal.innerText = peso.toFixed(2);
  valorBruto.innerText = bruto.toFixed(2);
  valorPix.innerText = descontoPix.toFixed(2);
  valorFinal.innerText = final.toFixed(2);
});
</script>

</body>
</html>
