<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Luxo | Abella Joias</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Poppins', sans-serif; background-color: #f8f6f2; }
.tab-content { display: none; }
.tab-content.active { display: block; }
.gold-text { color: #d4af37; }
.gold-bg { background-color: #d4af37; }

/* Status do Pedido */
.status-Novo { background: #fffbeb; color: #92400e; border: 1px solid #fde68a; }
.status-Separação { background: #eff6ff; color: #1e40af; border: 1px solid #bfdbfe; }
.status-Enviado { background: #f5f3ff; color: #5b21b6; border: 1px solid #ddd6fe; }
.status-Finalizado { background: #ecfdf5; color: #065f46; border: 1px solid #a7f3d0; }

@media print {
    body * { visibility: hidden; }
    #romaneio-print, #romaneio-print * { visibility: visible; }
    #romaneio-print { position: absolute; top: 0; left: 0; width: 100%; padding: 20px; color: black; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #000; padding: 8px; text-align: left; font-size: 12px; }
}
</style>
</head>
<body class="flex flex-col min-h-screen">

<header class="bg-black text-white p-6 shadow-xl border-b-4 border-[#d4af37]">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
        <div>
            <h1 class="text-xl font-bold tracking-widest">ABELLA JOIAS</h1>
            <p class="text-[10px] text-[#d4af37] uppercase tracking-[0.3em]">Gestão Administrativa</p>
        </div>
        <nav class="hidden md:flex gap-8 text-xs font-bold uppercase tracking-widest">
            <button onclick="showTab('pedidos')" class="hover:text-[#d4af37] transition">Pedidos</button>
            <button onclick="showTab('produtos')" class="hover:text-[#d4af37] transition">Produtos</button>
            <button onclick="showTab('categorias')" class="hover:text-[#d4af37] transition">Categorias</button>
            <button onclick="showTab('galvanicas')" class="hover:text-[#d4af37] transition">Galvânicas</button>
            <button onclick="showTab('config')" class="hover:text-[#d4af37] transition">Ajustes</button>
        </nav>
    </div>
</header>

<main class="flex-grow max-w-7xl w-full mx-auto p-4 md:p-8">

<!-- PEDIDOS -->
<section id="pedidos" class="tab-content active">
    <h2 class="text-2xl font-bold mb-6">Pedidos Recentes</h2>
    <div id="listaPedidos" class="grid gap-4"></div>
</section>

<!-- PRODUTOS -->
<section id="produtos" class="tab-content">
    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 mb-8">
        <h3 id="formProdTitle" class="font-bold mb-4 uppercase text-sm tracking-widest">Novo Produto</h3>
        <form id="formProduto" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <input type="hidden" id="pId">
            <input type="text" id="pNome" placeholder="Nome" class="border p-2 rounded-lg text-sm" required>
            <input type="text" id="pSku" placeholder="SKU" class="border p-2 rounded-lg text-sm" required>
            <input type="number" step="0.01" id="pPreco" placeholder="Preço (R$)" class="border p-2 rounded-lg text-sm" required>
            <input type="number" step="0.01" id="pPeso" placeholder="Peso (g)" class="border p-2 rounded-lg text-sm" required>
            <select id="pCat" class="border p-2 rounded-lg text-sm col-span-1"></select>
            <input type="text" id="pImage" placeholder="URL da Imagem" class="border p-2 rounded-lg text-sm md:col-span-2">
            <button type="submit" class="bg-black text-white p-2 rounded-lg font-bold hover:bg-[#d4af37] transition">SALVAR</button>
            <button type="button" onclick="cancelarEdicaoProd()" id="btnCancelProd" class="hidden border border-red-500 text-red-500 p-2 rounded-lg text-xs font-bold">CANCELAR</button>
        </form>
    </div>
    <div id="gridProdutos" class="grid grid-cols-2 md:grid-cols-5 gap-4"></div>
</section>

<!-- GALVÂNICAS -->
<section id="galvanicas" class="tab-content">
    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 mb-8">
        <h3 id="formGalvTitle" class="font-bold mb-4 uppercase text-sm tracking-widest gold-text">Gestão de Galvânicas</h3>
        <form id="formGalvanica" class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <input type="hidden" id="gId">
            <input type="text" id="gNome" placeholder="Empresa" class="border p-2 rounded-lg text-sm" required>
            <input type="text" id="gWhats" placeholder="WhatsApp (55...)" class="border p-2 rounded-lg text-sm" required>
            <input type="text" id="gTel" placeholder="Telefone Fixo" class="border p-2 rounded-lg text-sm">
            <input type="text" id="gEnd" placeholder="Endereço" class="border p-2 rounded-lg text-sm md:col-span-3" required>
            <textarea id="gDesc" placeholder="Descrição dos serviços" class="border p-2 rounded-lg text-sm md:col-span-3"></textarea>
            <input type="text" id="gLogo" placeholder="URL Logotipo" class="border p-2 rounded-lg text-sm md:col-span-2">
            <button type="submit" class="bg-[#d4af37] text-white p-2 rounded-lg font-bold">SALVAR GALVÂNICA</button>
            <button type="button" onclick="cancelarEdicaoGalv()" id="btnCancelGalv" class="hidden border border-red-500 text-red-500 p-2 rounded-lg text-xs font-bold">CANCELAR</button>
        </form>
    </div>
    <div id="listaGalvAdmin" class="grid gap-4"></div>
</section>

<!-- CONFIG -->
<section id="config" class="tab-content">
    <div class="bg-white p-8 rounded-2xl shadow-sm border max-w-2xl mx-auto">
        <h2 class="text-xl font-bold mb-6 italic">Configurações Gerais</h2>
        <div class="space-y-4">
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase">WhatsApp de Recebimento</label>
                <input type="text" id="confPhone" class="w-full border p-3 rounded-xl mt-1">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">Desconto PIX (%)</label>
                    <input type="number" id="confPix" class="w-full border p-3 rounded-xl mt-1">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">Parcelas Sem Juros (Ex: 3)</label>
                    <input type="number" id="confParc" class="w-full border p-3 rounded-xl mt-1">
                </div>
            </div>
            <button onclick="salvarConfig()" class="w-full bg-black text-white py-4 rounded-xl font-bold shadow-lg mt-4 hover:bg-[#d4af37] transition">ATUALIZAR DADOS</button>
        </div>
    </div>
</section>

<!-- CATEGORIAS -->
<section id="categorias" class="tab-content">
    <div class="bg-white p-6 rounded-2xl shadow-sm border max-w-md">
        <h3 class="font-bold mb-4">Criar Categoria</h3>
        <input type="text" id="catNome" placeholder="Ex: Anéis" class="w-full border p-2 rounded-lg mb-4">
        <input type="file" id="catFile" class="text-xs mb-4">
        <button onclick="salvarCategoria()" class="w-full bg-black text-white p-3 rounded-lg font-bold uppercase text-xs">Adicionar</button>
    </div>
    <div id="listaCategorias" class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8"></div>
</section>

</main>

<!-- ROMANEIO -->
<div id="romaneio-print" class="hidden">
    <div style="text-align:center; border-bottom:2px solid #000; padding-bottom:10px;">
        <h1 style="font-size:22px; font-weight:bold; margin:0;">ABELLA JOIAS</h1>
        <p style="font-size:10px; text-transform:uppercase; letter-spacing:2px;">Romaneio de Separação de Pedido</p>
    </div>
    <div id="romaneio-info" style="margin-top:20px; font-size:13px;"></div>
    <table id="romaneio-table">
        <thead>
            <tr>
                <th style="width:15%;">SKU</th>
                <th style="width:50%;">Produto</th>
                <th style="width:15%;">Peso (g)</th>
                <th style="width:20%;">Preço</th>
            </tr>
        </thead>
        <tbody id="romaneio-body"></tbody>
    </table>
    <div id="romaneio-footer" style="margin-top:20px; text-align:right; font-weight:bold; border-top:1px solid #000; padding-top:10px;"></div>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
    authDomain: "catalogo-abella-joias.firebaseapp.com",
    databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
    projectId: "catalogo-abella-joias",
    storageBucket: "catalogo-abella-joias.appspot.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

// --- ABAS ---
function showTab(id) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

// --- PRODUTOS ---
document.getElementById('formProduto').onsubmit = e => {
    e.preventDefault();
    const id = document.getElementById('pId').value;
    const p = {
        name: document.getElementById('pNome').value,
        sku: document.getElementById('pSku').value,
        price: parseFloat(document.getElementById('pPreco').value),
        weight: parseFloat(document.getElementById('pPeso').value),
        category: document.getElementById('pCat').value,
        image: document.getElementById('pImage').value || 'https://via.placeholder.com/300'
    };
    if(id) db.ref('products/' + id).update(p);
    else db.ref('products').push(p);
    cancelarEdicaoProd();
};

function editarProduto(id,p){
    document.getElementById('pId').value=id;
    document.getElementById('pNome').value=p.name;
    document.getElementById('pSku').value=p.sku;
    document.getElementById('pPreco').value=p.price;
    document.getElementById('pPeso').value=p.weight;
    document.getElementById('pCat').value=p.category;
    document.getElementById('pImage').value=p.image;
    document.getElementById('formProdTitle').innerText="Editando Produto";
    document.getElementById('btnCancelProd').classList.remove('hidden');
    window.scrollTo(0,0);
}
function cancelarEdicaoProd(){
    document.getElementById('formProduto').reset();
    document.getElementById('pId').value="";
    document.getElementById('formProdTitle').innerText="Novo Produto";
    document.getElementById('btnCancelProd').classList.add('hidden');
}

db.ref('products').on('value',snap=>{
    const grid=document.getElementById('gridProdutos'); grid.innerHTML='';
    snap.forEach(s=>{
        const p=s.val();
        grid.innerHTML+=`
        <div class="bg-white border rounded-xl overflow-hidden relative group">
            <img src="${p.image}" class="w-full aspect-square object-cover">
            <div class="p-2 text-[10px]">
                <p class="font-bold truncate uppercase">${p.name}</p>
                <p class="text-gray-400">SKU: ${p.sku} | <b>${p.weight}g</b></p>
                <p class="gold-text font-bold">R$ ${p.price.toFixed(2)}</p>
                <div class="mt-2 flex gap-1">
                    <button onclick='editarProduto("${s.key}",${JSON.stringify(p)})' class="bg-blue-600 text-white flex-1 py-1 rounded">EDITAR</button>
                    <button onclick="db.ref('products/${s.key}').remove()" class="bg-red-500 text-white px-2 py-1 rounded">✕</button>
                </div>
            </div>
        </div>
        `;
    });
});

// --- PEDIDOS ---
db.ref('orders').on('value',snap=>{
    const list=document.getElementById('listaPedidos'); list.innerHTML='';
    snap.forEach(s=>{
        const o=s.val();
        list.innerHTML+=`
        <div class="bg-white border rounded-2xl p-4 flex justify-between items-center shadow-sm">
            <div class="text-xs">
                <p class="font-bold text-sm uppercase">${o.cliente}</p>
                <p class="text-gray-400">${o.data}</p>
                <p class="gold-text font-bold mt-1">Total: R$ ${parseFloat(o.total).toFixed(2)}</p>
            </div>
            <div class="flex gap-2">
                <select onchange="db.ref('orders/${s.key}').update({status:this.value})" class="status-${o.status||'Novo'} text-[10px] font-bold p-2 rounded-lg border-none">
                    <option ${o.status=='Novo'?'selected':''}>Novo</option>
                    <option ${o.status=='Separação'?'selected':''}>Separação</option>
                    <option ${o.status=='Enviado'?'selected':''}>Enviado</option>
                    <option ${o.status=='Finalizado'?'selected':''}>Finalizado</option>
                </select>
                <button onclick='imprimirRomaneio(${JSON.stringify(o)})' class="bg-black text-white px-3 py-2 rounded-lg text-[10px] font-bold">ROMANEIO</button>
                <button onclick='editarPedido("${s.key}",${o.total})' class="bg-blue-600 text-white px-3 py-2 rounded-lg text-[10px] font-bold uppercase">Editar</button>
                <button onclick="db.ref('orders/${s.key}').remove()" class="text-red-500 text-[10px] p-2">✕</button>
            </div>
        </div>
        `;
    });
});

function editarPedido(id,totalAtual){
    const novo=prompt("Novo valor total para este pedido:",totalAtual);
    if(novo!==null) db.ref('orders/'+id).update({total:parseFloat(novo)});
}

function imprimirRomaneio(o){
    document.getElementById('romaneio-info').innerHTML=`
        <p><strong>Cliente:</strong> ${o.cliente} | <strong>WhatsApp:</strong> ${o.whatsapp||'N/A'}</p>
        <p><strong>Data:</strong> ${o.data} | <strong>Pagamento:</strong> ${o.pagamento}</p>
    `;
    const tbody=document.getElementById('romaneio-body'); tbody.innerHTML='';
    let pesoTotal=0;
    o.itens.forEach(i=>{
        pesoTotal+=(i.weight||0);
        tbody.innerHTML+=`<tr><td>${i.sku}</td><td>${i.name}</td><td>${(i.weight||0).toFixed(2)}g</td><td>R$ ${i.price.toFixed(2)}</td></tr>`;
    });
    document.getElementById('romaneio-footer').innerHTML=`
        <p>Qtd Itens: ${o.itens.length}</p>
        <p>PESO TOTAL: ${pesoTotal.toFixed(2)} g</p>
        <p>VALOR FINAL: R$ ${parseFloat(o.total).toFixed(2)}</p>
    `;
    window.print();
}

// --- GALVÂNICAS ---
document.getElementById('formGalvanica').onsubmit = e => {
    e.preventDefault();
    const id=document.getElementById('gId').value;
    const g={
        nome: document.getElementById('gNome').value,
        whats: document.getElementById('gWhats').value,
        tel: document.getElementById('gTel').value,
        end: document.getElementById('gEnd').value,
        desc: document.getElementById('gDesc').value,
        logo: document.getElementById('gLogo').value || 'https://via.placeholder.com/150'
    };
    if(id) db.ref('galvanicas/'+id).update(g);
    else db.ref('galvanicas').push(g);
    cancelarEdicaoGalv();
};

db.ref('galvanicas').on('value',snap=>{
    const list=document.getElementById('listaGalvAdmin'); list.innerHTML='';
    snap.forEach(s=>{
        const g=s.val();
        const key=s.key;
        list.innerHTML+=`
        <div class="bg-white border rounded-xl p-4 flex justify-between items-center shadow-sm">
            <div class="flex items-center gap-4 text-xs">
                <img src="${g.logo}" class="w-12 h-12 rounded-full object-cover border">
                <div>
                    <p class="font-bold">${g.nome}</p>
                    <p class="text-gray-400">${g.end}</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="editarGalvanica('${key}')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-[10px] font-bold">EDITAR</button>
                <button onclick="db.ref('galvanicas/${key}').remove()" class="text-red-500 font-bold text-[10px]">✕ REMOVER</button>
            </div>
        </div>`;
    });
});

function editarGalvanica(id){
    db.ref('galvanicas/'+id).once('value').then(s=>{
        const g=s.val();
        document.getElementById('gId').value=id;
        document.getElementById('gNome').value=g.nome;
        document.getElementById('gWhats').value=g.whats;
        document.getElementById('gTel').value=g.tel;
        document.getElementById('gEnd').value=g.end;
        document.getElementById('gDesc').value=g.desc;
        document.getElementById('gLogo').value=g.logo;
        document.getElementById('formGalvTitle').innerText="Editando Galvânica";
        document.getElementById('btnCancelGalv').classList.remove('hidden');
    });
}
function cancelarEdicaoGalv(){
    document.getElementById('formGalvanica').reset();
    document.getElementById('gId').value="";
    document.getElementById('formGalvTitle').innerText="Gestão de Galvânicas";
    document.getElementById('btnCancelGalv').classList.add('hidden');
}

// --- CATEGORIAS ---
function salvarCategoria(){
    const nome=document.getElementById('catNome').value;
    const file=document.getElementById('catFile').files[0];
    if(!nome) return alert('Digite o nome da categoria');
    if(file){
        const ref=storage.ref('categorias/'+file.name);
        ref.put(file).then(()=>ref.getDownloadURL().then(url=>{
            db.ref('categories').push({name:nome,image:url});
        }));
    }else db.ref('categories').push({name:nome,image:'https://via.placeholder.com/150'});
}

db.ref('categories').on('value',snap=>{
    const list=document.getElementById('listaCategorias'); list.innerHTML='';
    const select=document.getElementById('pCat'); select.innerHTML='';
    snap.forEach(s=>{
        const c=s.val();
        list.innerHTML+=`
        <div class="bg-white border rounded-xl p-4 text-center">
            <img src="${c.image}" class="w-full h-24 object-cover rounded-lg mb-2">
            <p class="font-bold text-sm truncate">${c.name}</p>
        </div>`;
        select.innerHTML+=`<option value="${c.name}">${c.name}</option>`;
    });
});

// --- CONFIG ---
function salvarConfig(){
    const phone=document.getElementById('confPhone').value;
    const pix=parseFloat(document.getElementById('confPix').value)||0;
    const parc=parseInt(document.getElementById('confParc').value)||1;
    db.ref('config').set({phone,pix,parc});
}
</script>

</body>
</html>
