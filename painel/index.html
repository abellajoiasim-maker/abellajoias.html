<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Administrativo | Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
    body{background:#F8F6F2}
    .font-serif{font-family:'Cinzel',serif}
    .gold{color:#A68966}
    .image-container {
        width: 100%;
        aspect-ratio: 1 / 1;
        overflow: hidden;
        background-color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        border-bottom: 1px solid #eee;
    }
    .image-container img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }
</style>
</head>

<body class="p-6">

<div class="max-w-6xl mx-auto">
    <h1 class="font-serif text-3xl gold mb-8 text-center uppercase tracking-widest">Painel Administrativo</h1>

    <div class="bg-white p-6 rounded-lg shadow-sm border border-[#A68966]/20 mb-10">
        <h2 class="font-bold mb-4 uppercase text-sm gold">Gerenciar Produto</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <input type="text" id="pNome" placeholder="Nome do Produto" class="border p-2 rounded text-sm">
            <input type="text" id="pSku" placeholder="SKU" class="border p-2 rounded text-sm">
            <input type="text" id="pCategoria" placeholder="Categoria" class="border p-2 rounded text-sm">
            <input type="number" id="pPreco" placeholder="Preço" class="border p-2 rounded text-sm">
            <input type="number" id="pPeso" placeholder="Peso (g)" class="border p-2 rounded text-sm">
            <input type="text" id="pImagemUrl" placeholder="URL da Imagem" class="border p-2 rounded text-sm">
        </div>
        <button onclick="salvarProduto()" class="mt-4 bg-black text-white px-6 py-2 rounded font-bold uppercase text-xs tracking-widest">Salvar Produto</button>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-sm border mb-10">
        <h2 class="font-bold mb-2 uppercase text-sm">Importar CSV</h2>
        <input type="file" id="csvFile" accept=".csv" class="text-sm">
        <button onclick="importarCSV()" class="ml-2 bg-gray-200 px-4 py-1 rounded text-xs font-bold uppercase">Processar Arquivo</button>
        <div id="importStatus" class="mt-2 text-xs"></div>
    </div>

    <div class="mb-10">
        <h2 class="font-serif gold text-2xl mb-4 uppercase tracking-widest text-center">Pedidos Recebidos</h2>
        <div id="lista-pedidos" class="grid grid-cols-1 gap-4">
            </div>
    </div>

    <h2 class="font-serif gold text-2xl mb-6 uppercase tracking-widest text-center">Produtos no Catálogo</h2>
    <div id="lista-produtos" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
</div>

<div id="modalPedido" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50 p-4">
    <div class="bg-white p-6 rounded-lg max-w-lg w-full max-h-[80vh] overflow-y-auto">
        <h3 class="font-serif gold text-lg mb-4 uppercase">Itens do Pedido</h3>
        <div id="detalhes-itens" class="space-y-4"></div>
        <button onclick="document.getElementById('modalPedido').classList.add('hidden')" class="w-full mt-6 bg-black text-white p-2 rounded font-bold">FECHAR</button>
    </div>
</div>

<script>
// Firebase Config (Mantida igual)
const firebaseConfig = {
    apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
    authDomain: "catalogo-abella-joias.firebaseapp.com",
    databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
    projectId: "catalogo-abella-joias",
    storageBucket: "catalogo-abella-joias.appspot.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let produtoEdit = null;

// --- FUNÇÕES DE PRODUTOS (IGUAIS ÀS ORIGINAIS) ---
function salvarProduto() {
    const p = {
        nome: document.getElementById('pNome').value,
        sku: document.getElementById('pSku').value,
        categoria: document.getElementById('pCategoria').value,
        preco: parseFloat(document.getElementById('pPreco').value),
        peso: parseFloat(document.getElementById('pPeso').value),
        imagem: document.getElementById('pImagemUrl').value
    };
    if(produtoEdit) {
        db.ref('products/' + produtoEdit).update(p);
        produtoEdit = null;
    } else {
        db.ref('products').push(p);
    }
    limparCampos();
}

function limparCampos() {
    document.querySelectorAll('input').forEach(i => i.value = "");
}

function carregarDados() {
    db.ref('products').on('value', snapshot => {
        const data = snapshot.val();
        const container = document.getElementById('lista-produtos');
        container.innerHTML = "";
        if(data) {
            Object.keys(data).forEach(id => {
                const p = data[id];
                container.innerHTML += `
                    <div class="bg-white border rounded shadow-sm overflow-hidden flex flex-col">
                        <div class="image-container"><img src="${p.imagem || ''}"></div>
                        <div class="p-3 flex-1">
                            <h4 class="text-[10px] font-bold uppercase mb-1">${p.nome}</h4>
                            <p class="text-[9px] text-gray-400 mb-2">${p.sku}</p>
                            <p class="gold font-bold text-xs">R$ ${p.preco}</p>
                        </div>
                        <div class="p-2 border-t flex gap-2">
                            <button onclick="prepararEdicao('${id}')" class="flex-1 text-[9px] bg-gray-100 py-1 rounded">EDITAR</button>
                            <button onclick="excluirProduto('${id}')" class="flex-1 text-[9px] bg-red-50 text-red-500 py-1 rounded">APAGAR</button>
                        </div>
                    </div>
                `;
            });
        }
    });

    // Carregar Pedidos
    carregarPedidos();
}

function excluirProduto(id) {
    if(confirm("Apagar produto?")) db.ref('products/' + id).remove();
}

function prepararEdicao(id) {
    db.ref('products/' + id).once('value', s => {
        const p = s.val();
        document.getElementById('pNome').value = p.nome;
        document.getElementById('pSku').value = p.sku;
        document.getElementById('pPreco').value = p.preco;
        document.getElementById('pPeso').value = p.peso;
        document.getElementById('pCategoria').value = p.categoria;
        document.getElementById('pImagemUrl').value = p.imagem;
        produtoEdit = id;
        window.scrollTo(0,0);
    });
}

// --- FUNÇÃO DE PEDIDOS (NOVIDADE) ---
function carregarPedidos() {
    db.ref('orders').on('value', snapshot => {
        const data = snapshot.val();
        const container = document.getElementById('lista-pedidos');
        container.innerHTML = "";
        if(data) {
            Object.keys(data).reverse().forEach(id => {
                const pedido = data[id];
                container.innerHTML += `
                    <div class="bg-white border-l-4 border-gold p-4 shadow-sm flex justify-between items-center">
                        <div>
                            <p class="text-xs text-gray-400">${pedido.data}</p>
                            <p class="font-bold text-sm uppercase">${pedido.cliente || 'S/ Nome'}</p>
                            <p class="text-xs gold">Total: R$ ${pedido.total} | ${pedido.pagamento}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="verItens('${id}')" class="bg-black text-white px-3 py-1 rounded text-[10px] font-bold">ITENS</button>
                            <button onclick="db.ref('orders/${id}').remove()" class="text-red-400 text-xs">Apagar</button>
                        </div>
                    </div>
                `;
            });
        }
    });
}

function verItens(id) {
    db.ref('orders/' + id).once('value', snapshot => {
        const p = snapshot.val();
        const container = document.getElementById('detalhes-itens');
        container.innerHTML = "";
        p.itens.forEach(item => {
            container.innerHTML += `
                <div class="flex gap-3 border-b pb-2 items-center">
                    <img src="${item.imagem}" class="w-10 h-10 object-contain">
                    <div class="flex-1">
                        <p class="text-[10px] font-bold uppercase">${item.nome}</p>
                        ${item.variacao ? `<p class="text-[9px] gold font-bold">OPÇÃO: ${item.variacao}</p>` : ''}
                        <p class="text-[9px] text-gray-400">SKU: ${item.sku} | Qtd: ${item.qty}</p>
                    </div>
                </div>
            `;
        });
        document.getElementById('modalPedido').classList.remove('hidden');
    });
}

carregarDados();
</script>
</body>
</html>
