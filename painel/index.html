<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin • Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{margin:0;font-family:Inter,Arial;background:#0b0b0b;color:#eee}
header{padding:20px;text-align:center;font-size:22px;font-weight:700;background:#000;border-bottom:1px solid #222}
nav{display:flex;gap:10px;padding:10px;background:#111;flex-wrap:wrap}
nav button{flex:1;background:#1a1a1a;border:1px solid #333;color:#fff;padding:10px;border-radius:10px;cursor:pointer}
nav button.active{border-color:#caa85c;color:#caa85c}
section{display:none;padding:20px}
section.active{display:block}

.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
@media(min-width:768px){.grid{grid-template-columns:repeat(4,1fr)}}
@media(min-width:1200px){.grid{grid-template-columns:repeat(6,1fr)}}

.card{background:#141414;border:1px solid #2a2a2a;border-radius:14px;padding:12px}
.row{display:flex;justify-content:space-between;align-items:center;gap:6px}
.tag{font-size:11px;padding:3px 8px;border-radius:999px}
.ok{background:#1f3;color:#000}
.no{background:#c33}
.btn{background:#222;border:1px solid #444;color:#fff;padding:6px 10px;border-radius:8px;font-size:12px}
.btn.pause{border-color:#caa85c;color:#caa85c}
.btn.danger{border-color:#c33;color:#f77}

input{background:#111;border:1px solid #333;color:#fff;padding:8px;border-radius:6px;width:100%;margin-bottom:8px}

#modalEdit{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:100;align-items:center;justify-content:center}
.modal-content{background:#141414;border:1px solid #333;width:100%;max-width:520px;border-radius:20px;padding:20px;max-height:90vh;overflow:auto}
.modal-img{width:100%;height:180px;object-fit:contain;background:#000;border-radius:10px;margin-bottom:10px}
.cat-divider{margin:25px 0 10px;border-bottom:1px solid #222;color:#caa85c;font-size:13px;font-weight:bold}
</style>
</head>

<body>

<header>Painel Administrativo • Abella Joias</header>

<nav>
<button class="active" onclick="show('empresa',this)">Empresa</button>
<button onclick="show('categorias',this)">Categorias</button>
<button onclick="show('produtos',this)">Produtos</button>
<button onclick="show('promocoes',this)">Promoções</button>
<button onclick="show('pedidos',this)">Pedidos</button>
</nav>

<section id="empresa" class="active">
<h2 class="font-bold mb-3">Empresa</h2>
<div class="card max-w-md">
<input id="empNome" placeholder="Nome">
<input id="empWhats" placeholder="WhatsApp">
<input id="empPix" type="number" placeholder="Desconto PIX %">
<input id="empParc" type="number" placeholder="Parcelas">
<button class="btn" onclick="salvarEmpresa()">Salvar</button>
</div>
</section>

<section id="categorias">
<h2 class="font-bold mb-3">Categorias</h2>
<div class="grid" id="listaCategorias"></div>
</section>

<section id="produtos">
<h2 class="font-bold mb-3">Produtos</h2>
<div id="produtosPorCategoria"></div>
</section>

<section id="promocoes">
<h2 class="font-bold mb-3">Promoções por Categoria</h2>
<div id="listaPromos" class="grid"></div>
</section>

<section id="pedidos">
<h2 class="font-bold mb-3">Pedidos</h2>
<div id="listaPedidos"></div>
</section>

<div id="modalEdit">
<div class="modal-content">
<div class="row mb-3">
<strong id="modalTitle"></strong>
<button class="btn" onclick="closeModal()">✕</button>
</div>
<div id="modalBody"></div>
<button class="btn w-full mt-3" onclick="salvarModal()">Salvar</button>
</div>
</div>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
 databaseURL:"https://catalogo-abella-joias-default-rtdb.firebaseio.com"
});
const db=firebase.database();
let MODAL={};

function show(id,btn){
document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
document.getElementById(id).classList.add('active');
document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
}
function closeModal(){modalEdit.style.display='none'}

// EMPRESA
db.ref('settings').on('value',s=>{
const v=s.val()||{};
empNome.value=v.nome||'';
empWhats.value=v.whatsapp||'';
empPix.value=v.pix||0;
empParc.value=v.parcelas||1;
});
function salvarEmpresa(){
db.ref('settings').update({
nome:empNome.value,
whatsapp:empWhats.value,
pix:+empPix.value,
parcelas:+empParc.value
});
alert('Salvo');
}

// CATEGORIAS + VARIAÇÕES
db.ref('categories').on('value',s=>{
listaCategorias.innerHTML='';
s.forEach(c=>{
const d=c.val();
listaCategorias.innerHTML+=`
<div class="card">
<div class="row"><strong>${d.name}</strong></div>
<div class="text-xs">${Object.keys(d.variacoes||{}).length} variações</div>
<div class="row mt-2">
<button class="btn" onclick="editarCategoria('${c.key}')">Editar</button>
<button class="btn pause" onclick="toggle('categories','${c.key}')">Pausar</button>
</div>
</div>`;
});
});

function editarCategoria(id){
db.ref('categories/'+id).once('value',s=>{
const v=s.val();
MODAL={type:'cat',id};
modalTitle.innerText='Editar Categoria';
modalBody.innerHTML=`
<input id="mNome" value="${v.name||''}">
<input id="mImg" value="${v.image||''}">
<h4 class="text-xs mt-2">Variações</h4>
<div id="vars"></div>
<input id="novaVar" placeholder="Nova variação">
<button class="btn" onclick="addVar()">Adicionar</button>`;
renderVars(v.variacoes||{});
modalEdit.style.display='flex';
});
}
function renderVars(vars){
varsDiv=document.getElementById('vars');
varsDiv.innerHTML='';
Object.keys(vars).forEach(k=>{
varsDiv.innerHTML+=`
<div class="row">
<span>${k}</span>
<button class="btn danger" onclick="delVar('${k}')">✕</button>
</div>`;
});
}
function addVar(){
db.ref(`categories/${MODAL.id}/variacoes/${novaVar.value}`).set({ativo:true});
novaVar.value='';
}
function delVar(k){
db.ref(`categories/${MODAL.id}/variacoes/${k}`).remove();
}

function salvarModal(){
if(MODAL.type==='cat'){
db.ref('categories/'+MODAL.id).update({
name:mNome.value,
image:mImg.value
});
}
closeModal();
}

// PROMOÇÕES
db.ref('categories').on('value',s=>{
listaPromos.innerHTML='';
s.forEach(c=>{
const d=c.val();
listaPromos.innerHTML+=`
<div class="card">
<strong>${d.name}</strong>
<input type="number" placeholder="Desconto %" value="${d.discount||0}"
onchange="db.ref('categories/${c.key}').update({discount:+this.value})">
<label><input type="checkbox" ${d.promo?'checked':''}
onchange="db.ref('categories/${c.key}').update({promo:this.checked})"> Ativa</label>
</div>`;
});
});

// PEDIDOS
db.ref('orders').on('value',s=>{
listaPedidos.innerHTML='';
s.forEach(o=>{
listaPedidos.innerHTML+=`<div class="text-xs border-b">${o.val().sku||''}</div>`;
});
});
</script>

</body>
</html>
