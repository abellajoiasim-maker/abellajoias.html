<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Administrativo | Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body { background:#F8F6F2 }
.font-serif{font-family:'Cinzel',serif}
.gold{color:#A68966}
.tab{display:none}
.tab.active{display:block}

.badge {
  display:inline-block;
  padding:2px 8px;
  font-size:10px;
  font-weight:700;
  border-radius:999px;
}

.badge-new { background:#fde68a; color:#92400e }
.badge-separated { background:#bfdbfe; color:#1e3a8a }
.badge-invoiced { background:#bbf7d0; color:#065f46 }

.price-old { text-decoration: line-through; color:#999; font-size:11px }
.price-main { font-weight:700; color:#A68966 }
</style>
</head>

<body>

<header class="bg-white border-b px-10 py-6 flex justify-between">
  <div>
    <h1 class="font-serif text-xl tracking-widest gold">Abella Joias</h1>
    <p class="text-xs tracking-widest text-gray-400 uppercase">Painel Administrativo</p>
  </div>

  <nav class="flex gap-8 text-xs tracking-widest uppercase">
    <button onclick="openTab('empresa')" class="gold">Empresa</button>
    <button onclick="openTab('selos')">Selos</button>
    <button onclick="openTab('pedidos')">Pedidos</button>
  </nav>
</header>

<main class="max-w-7xl mx-auto p-8 space-y-16">

<!-- ================= EMPRESA ================= -->
<section id="empresa" class="tab active space-y-6">
<h2 class="font-serif text-2xl gold">Empresa</h2>
<div class="bg-white border p-6 grid md:grid-cols-2 gap-4">
  <input id="empNome" placeholder="Nome da empresa" class="border p-3">
  <input id="empWhatsapp" placeholder="WhatsApp que recebe pedidos" class="border p-3">
  <input id="empPix" type="number" placeholder="Desconto PIX (%)" class="border p-3">
  <input id="empParcelas" type="number" placeholder="Parcelas no cartão sem acréscimo" class="border p-3">
</div>
<button onclick="salvarEmpresa()" class="bg-black text-white px-8 py-3 text-xs">SALVAR</button>
</section>

<!-- ================= SELLOS ================= -->
<section id="selos" class="tab space-y-6">
<h2 class="font-serif text-2xl gold">Selos Promocionais</h2>

<div class="bg-white border p-6 grid md:grid-cols-4 gap-4">
  <input id="seloNome" placeholder="Nome do selo (ex: Black Friday)" class="border p-3">
  <input id="seloDesc" type="number" placeholder="Desconto % (ex: 30)" class="border p-3">
  <input id="seloCor" placeholder="Cor (ex: #000000)" class="border p-3">
  <button onclick="salvarSelo()" class="bg-black text-white text-xs">SALVAR SELO</button>
</div>

<div id="listaSelos" class="grid md:grid-cols-3 gap-4"></div>
</section>

<!-- ================= PEDIDOS ================= -->
<section id="pedidos" class="tab space-y-6">
<h2 class="font-serif text-2xl gold">Pedidos</h2>
<div id="listaPedidos" class="space-y-4"></div>
</section>

</main>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias"
});
const db = firebase.database();

/* ================= NAVEGAÇÃO ================= */
function openTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* ================= EMPRESA ================= */
function salvarEmpresa(){
  db.ref('settings').set({
    nome: empNome.value,
    whatsapp: empWhatsapp.value,
    pix: Number(empPix.value || 0),
    parcelas: Number(empParcelas.value || 1)
  });
}
db.ref('settings').on('value', s=>{
  if(!s.val()) return;
  empNome.value=s.val().nome||'';
  empWhatsapp.value=s.val().whatsapp||'';
  empPix.value=s.val().pix||0;
  empParcelas.value=s.val().parcelas||1;
});

/* ================= SELLOS ================= */
let seloEdit=null;
function salvarSelo(){
  const s={nome:seloNome.value,desconto:Number(seloDesc.value||0),cor:seloCor.value};
  if(seloEdit){db.ref('selos/'+seloEdit).set(s);seloEdit=null;}
  else db.ref('selos').push(s);
  seloNome.value=seloDesc.value=seloCor.value='';
}
db.ref('selos').on('value',snap=>{
  const l=document.getElementById('listaSelos'); l.innerHTML='';
  snap.forEach(s=>{
    const v=s.val();
    l.innerHTML+=`
    <div class="bg-white border p-4">
      <span class="badge" style="background:${v.cor};color:#fff">${v.nome} - ${v.desconto}%</span>
      <div class="mt-2 flex gap-2 text-xs">
        <button onclick="editarSelo('${s.key}','${v.nome}','${v.desconto}','${v.cor}')" class="text-blue-600">Editar</button>
        <button onclick="db.ref('selos/${s.key}').remove()" class="text-red-600">Excluir</button>
      </div>
    </div>`;
  });
});
function editarSelo(id,n,d,c){
  seloNome.value=n; seloDesc.value=d; seloCor.value=c; seloEdit=id;
}

/* ================= PEDIDOS ================= */
db.ref('pedidos').on('value',snap=>{
  const l=document.getElementById('listaPedidos'); l.innerHTML='';
  snap.forEach(s=>{
    const p=s.val();
    const badge = p.status==='separado'?'badge-separated':p.status==='faturado'?'badge-invoiced':'badge-new';
    l.innerHTML+=`
    <div class="bg-white border p-4">
      <div class="flex justify-between">
        <div>
          <p class="font-bold">${p.cliente}</p>
          <p class="text-xs text-gray-500">${p.whatsapp}</p>
        </div>
        <span class="badge ${badge}">${p.status||'novo'}</span>
      </div>

      <p class="mt-2 text-sm">Total: <strong>R$ ${p.total}</strong></p>

      <div class="mt-3 flex gap-3 text-xs">
        <select onchange="atualizarStatus('${s.key}',this.value)" class="border p-1">
          <option value="novo">Novo</option>
          <option value="separado">Separado</option>
          <option value="faturado">Faturado</option>
        </select>
        <button onclick="gerarRomaneio('${s.key}',false)" class="text-blue-600">Romaneio simples</button>
        <button onclick="gerarRomaneio('${s.key}',true)" class="text-green-600">Romaneio completo</button>
      </div>
    </div>`;
  });
});

function atualizarStatus(id,st){ db.ref('pedidos/'+id+'/status').set(st); }

function gerarRomaneio(id,completo){
  alert(completo
    ? 'Romaneio COMPLETO será gerado (PDF)'
    : 'Romaneio SIMPLES para expedição');
}
</script>

</body>
</html>
