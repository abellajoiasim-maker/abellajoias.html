<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin • Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{margin:0;font-family:Inter,Arial;background:#0b0b0b;color:#eee}
header{padding:20px;text-align:center;font-size:22px;font-weight:700;background:#000;border-bottom:1px solid #222}
nav{display:flex;gap:10px;padding:10px;background:#111;flex-wrap:wrap}
nav button{flex:1;background:#1a1a1a;border:1px solid #333;color:#fff;padding:10px;border-radius:10px;cursor:pointer}
nav button.active{border-color:#caa85c;color:#caa85c}
section{display:none;padding:20px}
section.active{display:block}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
.card{background:#141414;border:1px solid #2a2a2a;border-radius:14px;padding:12px}
.row{display:flex;justify-content:space-between;align-items:center;gap:6px}
.tag{font-size:11px;padding:3px 8px;border-radius:999px}
.ok{background:#1f3;color:#000}
.no{background:#c33}
.btn{background:#222;border:1px solid #444;color:#fff;padding:6px 10px;border-radius:8px;cursor:pointer;font-size:12px}
.btn.pause{border-color:#caa85c;color:#caa85c}
.btn.danger{border-color:#c33;color:#f77}
input{background:#111;border:1px solid #333;color:#fff;padding:6px;border-radius:6px;width:100%}
</style>
</head>

<body>

<header>Painel Administrativo • Abella Joias</header>

<nav>
  <button class="active" onclick="show('empresa')">Empresa</button>
  <button onclick="show('categorias')">Categorias</button>
  <button onclick="show('produtos')">Produtos</button>
  <button onclick="show('promocoes')">Promoções</button>
  <button onclick="show('pedidos')">Pedidos</button>
</nav>

<section id="empresa" class="active">
  <h2 class="mb-3 font-bold">Empresa</h2>
  <div class="card max-w-md">
    <input id="empNome" placeholder="Nome">
    <input id="empWhats" placeholder="WhatsApp" class="mt-2">
    <input id="empPix" type="number" placeholder="Desconto PIX %" class="mt-2">
    <input id="empParc" type="number" placeholder="Parcelas" class="mt-2">
    <button class="btn mt-3" onclick="salvarEmpresa()">Salvar</button>
  </div>
</section>

<section id="categorias">
  <h2 class="mb-3 font-bold">Categorias</h2>
  <div class="grid" id="listaCategorias"></div>
</section>

<section id="produtos">
  <h2 class="mb-3 font-bold">Produtos</h2>
  <div id="produtosPorCategoria"></div>
</section>

<section id="promocoes">
  <h2 class="mb-3 font-bold">Promoções</h2>
  <p class="text-sm opacity-70">Promoções por categoria (estrutura mantida)</p>
</section>

<section id="pedidos">
  <h2 class="mb-3 font-bold">Pedidos</h2>
  <div id="listaPedidos"></div>
</section>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain:"catalogo-abella-joias.firebaseapp.com",
  databaseURL:"https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId:"catalogo-abella-joias",
  storageBucket:"catalogo-abella-joias.firebasestorage.app",
  messagingSenderId:"727568435294",
  appId:"1:727568435294:web:442c0179ecf0686dff4ccf"
});
const db=firebase.database();

function show(id){
 document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
 event.target.classList.add('active');
}

// EMPRESA
db.ref('settings').on('value',s=>{
 const v=s.val()||{};
 empNome.value=v.nome||'';
 empWhats.value=v.whatsapp||'';
 empPix.value=v.pix||0;
 empParc.value=v.parcelas||1;
});
function salvarEmpresa(){
 db.ref('settings').update({
  nome:empNome.value,
  whatsapp:empWhats.value,
  pix:+empPix.value,
  parcelas:+empParc.value
 });
 alert('Salvo');
}

// CATEGORIAS + VARIAÇÕES
db.ref('categories').on('value',snap=>{
 listaCategorias.innerHTML='';
 snap.forEach(c=>{
  const d=c.val();
  listaCategorias.innerHTML+=`
   <div class="card">
    <div class="row">
     <strong>${d.name}</strong>
     <span class="tag ${d.image?'ok':'no'}">IMG</span>
    </div>
    <div class="text-xs opacity-70 mb-2">${Object.keys(d.variacoes||{}).length} variações</div>
    <div class="row">
     <button class="btn">Editar</button>
     <button class="btn pause">Pausar</button>
     <button class="btn danger">Excluir</button>
    </div>
   </div>`;
 });
});

// PRODUTOS AGRUPADOS POR CATEGORIA + SKU
db.ref('products').on('value',snap=>{
 const map={};
 snap.forEach(p=>{
  const v=p.val();
  if(!map[v.category]) map[v.category]=[];
  map[v.category].push(v);
 });
 produtosPorCategoria.innerHTML='';
 Object.keys(map).sort().forEach(cat=>{
  const lista=map[cat].sort((a,b)=>(a.sku||'').localeCompare(b.sku||''));
  let html=`<h3 class="mt-6 mb-2 font-bold">${cat}</h3><div class="grid">`;
  lista.forEach(p=>{
   html+=`
    <div class="card">
     <div class="row">
      <strong>${p.sku}</strong>
      <span class="tag ${p.image?'ok':'no'}">IMG</span>
     </div>
     <div class="text-sm">${p.name}</div>
     <div class="text-xs opacity-70">Peso: ${p.weight||'-'}</div>
     <div class="row mt-2">
      <button class="btn">Editar</button>
      <button class="btn pause">Pausar</button>
      <button class="btn danger">Excluir</button>
     </div>
    </div>`;
  });
  html+='</div>';
  produtosPorCategoria.innerHTML+=html;
 });
});

// PEDIDOS
db.ref('orders').on('value',s=>{
 listaPedidos.innerHTML='';
 s.forEach(o=>{
  const v=o.val();
  listaPedidos.innerHTML+=`
   <div class="border-b border-[#222] p-2 text-xs">
    ${v.sku||''} — R$ ${v.preco||''}
   </div>`;
 });
});
</script>

</body>
</html>
