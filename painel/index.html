<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin • Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{background:#0b0b0b;color:#eee;font-family:Inter,Arial}
.tab{display:none}
.tab.active{display:block}
.card{background:#141414;border:1px solid #2a2a2a;border-radius:14px;padding:12px}
.btn{padding:6px 10px;border-radius:8px;font-size:10px}
.btn-gold{background:#caa85c;color:#000;font-weight:700}
.btn-gray{background:#333}
.btn-red{background:#700}
.dot{width:8px;height:8px;border-radius:999px}
</style>
</head>

<body>

<nav class="flex sticky top-0 z-50 bg-black border-b border-[#222]">
  <button class="flex-1 p-4" onclick="showTab('empresa')">EMPRESA</button>
  <button class="flex-1 p-4" onclick="showTab('categorias')">CATEGORIAS</button>
  <button class="flex-1 p-4" onclick="showTab('produtos')">PRODUTOS</button>
  <button class="flex-1 p-4" onclick="showTab('promocoes')">PROMOÇÕES</button>
  <button class="flex-1 p-4" onclick="showTab('pedidos')">PEDIDOS</button>
</nav>

<main class="max-w-7xl mx-auto p-6">

<section id="empresa" class="tab active">
  <div class="card max-w-md">
    <h2 class="font-bold mb-4 text-[#caa85c]">Dados da Empresa</h2>
    <input id="empNome" placeholder="Nome" class="w-full mb-2 p-2 bg-black border">
    <input id="empWhats" placeholder="WhatsApp" class="w-full mb-2 p-2 bg-black border">
    <input id="empPix" type="number" placeholder="Desconto Pix %" class="w-full mb-2 p-2 bg-black border">
    <input id="empParc" type="number" placeholder="Parcelas" class="w-full mb-4 p-2 bg-black border">
    <button class="w-full btn-gold p-3 rounded-xl" onclick="salvarEmpresa()">SALVAR</button>
  </div>
</section>

<section id="categorias" class="tab">
  <button class="btn-gold mb-4" onclick="novaCategoria()">+ Nova Categoria</button>
  <div id="listaCategorias" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
</section>

<section id="produtos" class="tab">
  <div id="produtosPorCategoria"></div>
</section>

<section id="promocoes" class="tab">
  <h2 class="mb-4 font-bold text-[#caa85c]">Promoções por Categoria</h2>
  <div class="card max-w-lg">
    <div id="listaPromos" class="space-y-3"></div>
    <button class="w-full btn-gold mt-4 p-3 rounded-xl" onclick="salvarPromos()">APLICAR DESCONTOS</button>
  </div>
</section>

<section id="pedidos" class="tab">
  <div id="containerPedidos" class="space-y-4"></div>
</section>

</main>

<!-- MODAL -->
<div id="modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-4">
  <div class="card max-w-md w-full">
    <h3 id="modalTitulo" class="font-bold mb-3"></h3>
    <div id="modalBody"></div>
    <button class="btn-gold w-full mt-4" onclick="salvarModal()">SALVAR</button>
    <button class="btn-gray w-full mt-2" onclick="fecharModal()">FECHAR</button>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias",
});
const db = firebase.database();
let MODAL_CTX={};

function showTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* UTIL */
function pausar(path,id){db.ref(path+'/'+id+'/paused').set(true)}
function excluir(path,id){if(confirm('Excluir?')) db.ref(path+'/'+id).remove()}

/* MODAL */
function abrirModal(t,b,c){MODAL_CTX=c||{};modalTitulo.innerText=t;modalBody.innerHTML=b;modal.classList.remove('hidden')}
function fecharModal(){modal.classList.add('hidden');MODAL_CTX={}}

function editarCategoria(id){
  db.ref('categories/'+id).once('value').then(s=>{
    const d=s.val()||{};
    abrirModal(
      'Editar Categoria',
      `
        ${d.image?`<img src="${d.image}" class="w-full h-32 object-cover rounded mb-3">`:''}
        <input id="catName" value="${d.name||''}" class="w-full mb-2 p-2 bg-black border">
        <input id="catImg" value="${d.image||''}" class="w-full mb-4 p-2 bg-black border">
      `,
      {type:'editarCategoria',id}
    );
  });
}

<script>
function salvarModal(){

  /* ===== NOVA CATEGORIA ===== */
  if(MODAL_CTX.type === 'novaCategoria'){
    const id = catName.value.toLowerCase().replace(/[^a-z0-9]/g,'-');
    db.ref('categories/'+id).set({
      name: catName.value,
      image: catImg.value || '',
      active:true
    });
  }

  /* ===== EDITAR CATEGORIA ===== */
  if(MODAL_CTX.type === 'editarCategoria'){
    db.ref('categories/'+MODAL_CTX.id).update({
      name: catName.value,
      image: catImg.value || ''
    });
  }

  /* ===== EDITAR PRODUTO ===== */
  if(MODAL_CTX.type === 'editarProduto'){
    db.ref('products/'+MODAL_CTX.id).update({
      name: pName.value,
      sku: pSku.value,
      image: pImg.value
    });
  }

  fecharModal();
}

/* PRODUTOS */
function editarProduto(id){
  db.ref('products/'+id).once('value').then(s=>{
    const p=s.val()||{};
    abrirModal(
      'Editar Produto',
      `
        ${p.image?`<img src="${p.image}" class="w-full h-32 object-contain mb-3">`:''}
        <input id="pName" value="${p.name||''}" class="w-full mb-2 p-2 bg-black border">
        <input id="pSku" value="${p.sku||''}" class="w-full mb-2 p-2 bg-black border">
        <input id="pImg" value="${p.image||''}" class="w-full p-2 bg-black border">
      `,
      {type:'editarProduto',id}
    );
  });
}

function salvarProduto(){
  if(MODAL_CTX.type==='editarProduto'){
    db.ref('products/'+MODAL_CTX.id).update({
      name:pName.value,
      sku:pSku.value,
      image:pImg.value
    });
  }
  fecharModal();
}

/* PEDIDOS */
function abrirPedido(id){
  db.ref('orders/'+id).once('value').then(s=>{
    abrirModal('Romaneio', `<pre class="text-xs">${JSON.stringify(s.val(),null,2)}</pre>`);
  });
}

function statusPedido(id){
  const s=prompt('Novo status');
  if(s) db.ref('orders/'+id).update({status:s});
}
</script>

</body>
</html>
