<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel VIP ‚Ä¢ Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{background:#0b0b0b;color:#eee;font-family:Inter,Arial;padding-bottom:60px}
nav button.active{border-color:#caa85c;color:#caa85c;border-bottom:2px solid}
nav button{opacity:.6;padding:10px 5px;font-size:10px;text-transform:uppercase;font-weight:bold}
section{display:none}
section.active{display:block}
.card{background:#141414;border:1px solid #2a2a2a;border-radius:12px;padding:12px}
.btn{background:#caa85c;color:#000;font-weight:bold;padding:6px 10px;border-radius:6px;font-size:10px}
.btn-red{background:#ef4444;color:#fff}
.btn-gold{background:#caa85c;color:#000}
input{background:#1a1a1a;border:1px solid #333;color:#fff;padding:6px;border-radius:6px;width:100%}
</style>
</head>

<body>

<nav class="flex justify-around p-4 border-b border-[#222] sticky top-0 bg-black">
    <button onclick="showTab('tab-pedidos',this)" class="active">Pedidos</button>
    <button onclick="showTab('tab-produtos',this)">Produtos</button>
    <button onclick="showTab('tab-categorias',this)">Categorias</button>
    <button onclick="abrirModalConfig()">Config</button>
    <button onclick="abrirModalPromocao()">Promo</button>
</nav>

<main class="p-4 max-w-6xl mx-auto">

<section id="tab-pedidos" class="active">
    <div id="listaPedidos" class="space-y-3"></div>
</section>

<section id="tab-produtos"></section>
<section id="tab-categorias"></section>

</main>

<!-- MODAL -->
<div id="modal" class="fixed inset-0 bg-black/90 hidden flex items-center justify-center p-4 z-50">
<div class="bg-[#111] w-full max-w-md rounded-xl border border-[#333]">
    <div class="p-3 border-b border-[#222] flex justify-between">
        <h2 id="modalTitle" class="text-[#caa85c] text-xs"></h2>
        <button onclick="fecharModal()">‚úï</button>
    </div>
    <div id="modalBody" class="p-4"></div>
    <div class="p-3 text-right">
        <button id="btnSalvar" class="btn hidden">Salvar</button>
    </div>
</div>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
 apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
 authDomain: "catalogo-abella-joias.firebaseapp.com",
 databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
 projectId: "catalogo-abella-joias"
});
const db = firebase.database();
const pedidosRef = db.ref('orders');

function gerarRomaneio(id, tipo){
    db.ref('orders/'+id).once('value').then(snap=>{
        const p = snap.val();
        if(!p) return alert('Pedido n√£o encontrado');

        let itensHTML = '';
        Object.values(p.itens || {}).forEach(i=>{
            itensHTML += `
            <tr>
                <td>${i.qtd}x</td>
                <td>${i.nome}</td>
                <td>R$ ${(i.preco||0).toFixed(2)}</td>
                <td>R$ ${(i.qtd*(i.preco||0)).toFixed(2)}</td>
            </tr>`;
        });

        const win = window.open('', '_blank');
        win.document.write(`
        <html>
        <head>
            <title>Romaneio ${tipo}</title>
            <style>
                body{font-family:Arial;padding:20px}
                h1{margin-bottom:10px}
                table{width:100%;border-collapse:collapse;margin-top:15px}
                td,th{border:1px solid #ccc;padding:6px;font-size:12px}
                th{background:#eee}
            </style>
        </head>
        <body>
            <h1>Romaneio ${tipo.toUpperCase()}</h1>
            <p><b>Cliente:</b> ${p.cliente}</p>
            <p><b>WhatsApp:</b> ${p.whatsapp||'-'}</p>
            <table>
                <tr>
                    <th>Qtd</th>
                    <th>Produto</th>
                    <th>Unit.</th>
                    <th>Total</th>
                </tr>
                ${itensHTML}
            </table>
            <h2>Total: R$ ${(p.total||0).toFixed(2)}</h2>
            <script>window.print()</script>
        </body>
        </html>
        `);
    });
}

/* UTIL */
const money = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

/* TABS */
function showTab(id,btn){
 document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
 btn.classList.add('active');
}

/* MODAL */
let modalCallback=null;
function abrirModal(t,b,cb){
 modalTitle.innerHTML=t;
 modalBody.innerHTML=b;
 modal.classList.remove('hidden');
 btnSalvar.classList.toggle('hidden',!cb);
 modalCallback=cb;
}
btnSalvar.onclick=()=>{ modalCallback && modalCallback(); fecharModal(); }
function fecharModal(){ modal.classList.add('hidden'); }

/* PEDIDOS */
pedidosRef.on('value',snap=>{
 listaPedidos.innerHTML='';
 snap.forEach(o=>{
   const p=o.val();
   listaPedidos.innerHTML+=`
   <div class="card flex justify-between">
     <div>
       <b>#${o.key.slice(0,8)}</b><br>${p.cliente}<br>
       <small>${money(p.total||0)}</small>
     </div>
     <div class="flex gap-1">
       <button class="btn" onclick="verDetalhes('${o.key}')">Ver</button>
       <button class="btn btn-red" onclick="excluir('${o.key}')">‚úï</button>
     </div>
   </div>`;
 });
});

function verDetalhes(id){
 pedidosRef.child(id).once('value').then(s=>{
  const p=s.val();
  abrirModal('Pedido',`
   <b>${p.cliente}</b><br>
   Total: ${money(p.total||0)}
   <div class="mt-3 grid gap-2">
     <button class="btn" onclick="gerarRomaneio('${id}','simples')">üìÑ Simples</button>
     <button class="btn" onclick="gerarRomaneio('${id}','completo')">üñ®Ô∏è Completo</button>
     <button class="btn" onclick="gerarRomaneio('${id}','fotos')">üì∏ Com Fotos</button>

   </div>
  `);
 });
}

function excluir(id){
 if(confirm('Excluir pedido?')) pedidosRef.child(id).remove();
}

/* PLACEHOLDERS */
function abrirModalConfig(){abrirModal('Config','Em breve')}
function abrirModalPromocao(){abrirModal('Promo','Em breve')}
</script>

</body>
</html>
