<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Administrativo | Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
    body{background:#F8F6F2}
    .font-serif{font-family:'Cinzel',serif}
    .gold{color:#A68966}
    .tab{display:none}
    .tab.active{display:block}
    .btn-tab { border-bottom: 3px solid transparent; transition: 0.3s; }
    .btn-tab.active { border-color: #A68966; color: #A68966; font-weight: bold; }
</style>
</head>

<body class="p-4 md:p-8">

<div class="max-w-6xl mx-auto">
    <h1 class="font-serif text-3xl gold mb-8 text-center uppercase tracking-widest">Painel Administrativo</h1>

    <div class="flex justify-center gap-6 mb-10 border-b border-gray-200">
        <button onclick="mudarTab('produtos')" id="btn-produtos" class="btn-tab pb-2 active uppercase text-xs">ðŸ“¦ Produtos</button>
        <button onclick="mudarTab('pedidos')" id="btn-pedidos" class="btn-tab pb-2 uppercase text-xs">ðŸ›’ Pedidos Recebidos</button>
    </div>

    <div id="tab-produtos" class="tab active">
        <div class="bg-white p-6 rounded-xl shadow-sm border mb-8">
            <h2 class="font-bold mb-4 uppercase text-sm">Controle de Estoque</h2>
            <p class="text-xs text-gray-400 mb-4 italic">Use o Importador Mestre para grandes quantidades.</p>
            <div id="lista-produtos" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                </div>
        </div>
    </div>

    <div id="tab-pedidos" class="tab">
        <div class="bg-white p-6 rounded-xl shadow-sm border">
            <h2 class="font-bold mb-6 uppercase text-sm">Pedidos do CatÃ¡logo</h2>
            <div id="lista-pedidos" class="space-y-4">
                </div>
        </div>
    </div>
</div>

<div id="modalPedido" class="fixed inset-0 bg-black/80 hidden items-center justify-center p-4 z-50">
    <div class="bg-white p-8 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h2 class="font-serif gold text-xl">Itens do Pedido</h2>
            <button onclick="fecharModal()" class="text-2xl">&times;</button>
        </div>
        <div id="detalhes-itens" class="space-y-3"></div>
        <button onclick="fecharModal()" class="w-full bg-black text-white p-4 mt-8 rounded font-bold uppercase">Fechar</button>
    </div>
</div>

<script>
// ConfiguraÃ§Ã£o Firebase
const firebaseConfig = {
    apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
    authDomain: "catalogo-abella-joias.firebaseapp.com",
    databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
    projectId: "catalogo-abella-joias",
    storageBucket: "catalogo-abella-joias.appspot.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function mudarTab(nome) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.btn-tab').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-' + nome).classList.add('active');
    document.getElementById('btn-' + nome).classList.add('active');
    if(nome === 'pedidos') carregarPedidos();
}

// --- GESTÃƒO DE PRODUTOS ---
function carregarProdutos() {
    db.ref('products').limitToLast(50).on('value', snapshot => {
        const data = snapshot.val();
        const container = document.getElementById('lista-produtos');
        container.innerHTML = "";
        if (data) {
            Object.keys(data).forEach(id => {
                const p = data[id];
                container.innerHTML += `
                    <div class="border p-3 rounded flex gap-3 items-center bg-gray-50">
                        <img src="${p.imagem || ''}" class="w-12 h-12 object-cover bg-white">
                        <div class="flex-1">
                            <p class="text-[10px] font-bold uppercase truncate">${p.nome}</p>
                            <p class="text-[9px] text-gray-400">${p.sku}</p>
                        </div>
                        <button onclick="excluirProduto('${id}')" class="text-red-400 text-xs">Excluir</button>
                    </div>
                `;
            });
        }
    });
}

function excluirProduto(id) {
    if(confirm("Deseja apagar este produto?")) db.ref('products/' + id).remove();
}

// --- GESTÃƒO DE PEDIDOS (NOVO) ---
function carregarPedidos() {
    db.ref('orders').orderByChild('data').on('value', snapshot => {
        const data = snapshot.val();
        const container = document.getElementById('lista-pedidos');
        container.innerHTML = "";
        
        if (!data) {
            container.innerHTML = "<p class='text-gray-400 text-center'>Nenhum pedido recebido ainda.</p>";
            return;
        }

        const keys = Object.keys(data).reverse(); // Mais novos primeiro
        keys.forEach(id => {
            const pedido = data[id];
            container.innerHTML += `
                <div class="border-l-4 border-amber-500 bg-white p-4 shadow-sm flex flex-wrap justify-between items-center gap-4">
                    <div>
                        <p class="text-xs text-gray-400">${pedido.data}</p>
                        <p class="font-bold uppercase text-sm">${pedido.cliente || 'Cliente s/ nome'}</p>
                        <p class="text-xs gold">Pagamento: ${pedido.pagamento} | <b>Total: R$ ${pedido.total}</b></p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="verItens('${id}')" class="bg-black text-white px-4 py-2 rounded text-[10px] font-bold uppercase">Ver Itens</button>
                        <button onclick="excluirPedido('${id}')" class="bg-red-50 text-red-500 px-4 py-2 rounded text-[10px] font-bold uppercase border border-red-100">Excluir</button>
                    </div>
                </div>
            `;
        });
    });
}

function verItens(id) {
    db.ref('orders/' + id).once('value', snapshot => {
        const p = snapshot.val();
        const container = document.getElementById('detalhes-itens');
        container.innerHTML = "";
        
        p.itens.forEach(item => {
            container.innerHTML += `
                <div class="flex items-center gap-4 border-b pb-2">
                    <img src="${item.imagem}" class="w-12 h-12 object-contain bg-gray-50">
                    <div class="flex-1">
                        <p class="text-xs font-bold uppercase">${item.nome}</p>
                        <p class="text-[10px] text-gray-400">SKU: ${item.sku} | Peso: ${item.peso}g</p>
                        ${item.variacao ? `<p class="text-[10px] text-amber-600 font-bold">OPÃ‡ÃƒO: ${item.variacao}</p>` : ''}
                    </div>
                    <div class="text-right">
                        <p class="font-bold gold">Qtd: ${item.qty}</p>
                        <p class="text-[10px]">R$ ${item.preco}</p>
                    </div>
                </div>
            `;
        });
        document.getElementById('modalPedido').style.display = 'flex';
    });
}

function fecharModal() {
    document.getElementById('modalPedido').style.display = 'none';
}

function excluirPedido(id) {
    if(confirm("Deseja apagar este registro de pedido?")) db.ref('orders/' + id).remove();
}

// Inicializa
carregarProdutos();
</script>

</body>
</html>
