<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checkout | Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{background:#f8f6f2}
.gold{color:#A68966}
.card{background:#fff;border:1px solid #eee}
</style>
</head>

<body class="p-6">

<div class="max-w-5xl mx-auto grid md:grid-cols-3 gap-6">

<!-- üßæ DADOS DO CLIENTE -->
<div class="card p-6 space-y-4 md:col-span-2">
<h2 class="text-xl font-semibold gold">Dados do Cliente</h2>

<input id="nome" class="border p-3 w-full" placeholder="Nome completo">
<input id="whatsapp" class="border p-3 w-full" placeholder="WhatsApp com DDD">

<h3 class="font-semibold mt-4">Entrega</h3>
<input id="local" class="border p-3 w-full" placeholder="Nome do local">
<input id="endereco" class="border p-3 w-full" placeholder="Endere√ßo completo">
<input id="cidade" class="border p-3 w-full" placeholder="Cidade">

<h3 class="font-semibold mt-4">Pagamento</h3>
<select id="pagamento" class="border p-3 w-full">
<option>PIX</option>
<option>Cart√£o</option>
</select>

</div>

<!-- üõçÔ∏è RESUMO -->
<div class="card p-6 space-y-4">
<h2 class="text-xl font-semibold gold">Resumo do Pedido</h2>

<div id="itens" class="space-y-2 text-sm"></div>

<hr>

<div class="text-sm space-y-1">
<div class="flex justify-between"><span>Peso total:</span><span id="peso">0 g</span></div>
<div class="flex justify-between font-bold text-lg gold"><span>Total:</span><span id="total">R$ 0,00</span></div>
</div>

<button onclick="finalizar()" class="w-full mt-4 bg-black text-white py-3 text-sm tracking-widest">
FINALIZAR PEDIDO
</button>
</div>

</div>

<script>
/* üî• FIREBASE */
firebase.initializeApp({
apiKey:"AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
databaseURL:"https://catalogo-abella-joias-default-rtdb.firebaseio.com"
});
const db=firebase.database();

/* üõí CARRINHO (localStorage) */
let carrinho=JSON.parse(localStorage.getItem('carrinho')||'[]');
let pesoTotal=0,valorTotal=0;

carrinho.forEach(i=>{
pesoTotal+=i.peso*i.qtd;
valorTotal+=i.preco*i.qtd;
itens.innerHTML+=`
<div class="flex justify-between border-b pb-1">
<span>${i.nome} (${i.qtd}x)</span>
<span>R$ ${(i.preco*i.qtd).toFixed(2)}</span>
</div>`;
});

peso.innerText=pesoTotal.toFixed(2)+" g";
total.innerText="R$ "+valorTotal.toFixed(2);

/* ‚úÖ FINALIZAR */
function finalizar(){
if(!nome.value||!whatsapp.value){alert("Preencha nome e WhatsApp");return;}

const pedido={
cliente:nome.value,
whatsapp:whatsapp.value,
local:local.value,
endereco:endereco.value,
cidade:cidade.value,
pagamento:pagamento.value,
itens:carrinho,
total:valorTotal,
peso:pesoTotal,
status:"novo",
data:new Date().toISOString()
};

const ref=db.ref('orders').push(pedido);

db.ref('settings').once('value').then(s=>{
const cfg=s.val();
const msg=encodeURIComponent(
`Ol√° üòä
Gostaria de confirmar um pedido que acabei de fazer no cat√°logo da ${cfg.name}.

Nome: ${nome.value}
WhatsApp: ${whatsapp.value}
Valor do pedido: R$ ${valorTotal.toFixed(2)}
Forma de pagamento: ${pagamento.value}

Fico no aguardo das orienta√ß√µes para confirma√ß√£o e pagamento. Obrigado(a)!`
);

window.location=`https://wa.me/55${cfg.whatsapp}?text=${msg}`;
localStorage.removeItem('carrinho');
});
}
</script>

</body>
</html>
