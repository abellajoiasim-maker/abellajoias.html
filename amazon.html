<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abella Joias | Business Force</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #c5a059; }
        body { font-family: 'Inter', sans-serif; background: #f9f9f9; }
        .serif { font-family: 'Cinzel', serif; }
        .product-card { background: white; border-radius: 15px; transition: 0.3s; border: 1px solid #eee; }
        .product-card:hover { border-color: var(--gold); transform: translateY(-5px); }
        .loading-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body>

<header class="bg-white border-b sticky top-0 z-50 px-6 py-4">
    <div class="max-w-[1400px] mx-auto flex justify-between items-center">
        <div>
            <h1 class="serif text-xl font-bold tracking-widest">ABELLA <span class="text-[#c5a059]">BRUTOS</span></h1>
            <p id="db-status" class="text-[9px] font-bold text-orange-500 uppercase">Verificando Conexão...</p>
        </div>
        <div id="cart-summary" class="bg-black text-white px-4 py-2 rounded-full text-sm font-bold">
            Total: R$ 0,00
        </div>
    </div>
</header>

<div class="max-w-[1400px] mx-auto flex flex-col md:flex-row gap-6 p-6">
    <aside class="w-full md:w-64">
        <h3 class="text-xs font-black text-gray-400 uppercase mb-4">Categorias</h3>
        <nav id="side-categories" class="flex flex-col gap-2">
            <div class="h-8 bg-gray-200 rounded loading-pulse"></div>
            <div class="h-8 bg-gray-200 rounded loading-pulse"></div>
        </nav>
    </aside>

    <main class="flex-1">
        <div id="status-msg" class="mb-4 text-sm hidden"></div>
        <div id="product-grid" class="grid grid-cols-2 lg:grid-cols-4 gap-6">
            </div>
    </main>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
    // 1. Configuração (Verifique se esses dados estão corretos no seu Firebase)
    const firebaseConfig = {
        apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
        databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 2. Variáveis de Estado
    let globalProducts = [];
    const fM = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

    // 3. Função para Forçar a Carga
    function forceLoad() {
        console.log("Iniciando busca forçada de dados...");

        // CARREGAR CATEGORIAS
        db.ref('categories').on('value', snap => {
            const side = document.getElementById('side-categories');
            if (snap.exists()) {
                console.log("Categorias encontradas:", snap.val());
                side.innerHTML = `<button onclick="renderProducts(globalProducts)" class="text-left p-2 text-sm font-bold bg-white border rounded">Ver Tudo</button>`;
                snap.forEach(child => {
                    const cat = child.val();
                    side.innerHTML += `
                        <button onclick="filterCat('${child.key}')" class="text-left p-2 text-sm text-gray-600 hover:text-black hover:bg-white rounded transition">
                            ${cat.name}
                        </button>`;
                });
            } else {
                console.error("Nenhuma categoria encontrada no nó 'categories'");
                side.innerHTML = "<p class='text-xs text-red-500'>Nenhuma categoria no banco.</p>";
            }
        }, err => {
            alert("ERRO DE PERMISSÃO: Verifique as regras do Firebase.");
            console.error(err);
        });

        // CARREGAR PRODUTOS
        db.ref('products').on('value', snap => {
            const grid = document.getElementById('product-grid');
            const status = document.getElementById('db-status');
            
            if (snap.exists()) {
                status.innerText = "CONECTADO: " + snap.numChildren() + " PRODUTOS";
                status.classList.replace('text-orange-500', 'text-green-500');
                
                globalProducts = [];
                snap.forEach(child => {
                    globalProducts.push({ id: child.key, ...child.val() });
                });
                
                renderProducts(globalProducts);
            } else {
                status.innerText = "ERRO: BANCO VAZIO";
                grid.innerHTML = `
                    <div class="col-span-full p-10 text-center border-2 border-dashed rounded-xl">
                        <p class="text-gray-500">O nó <b>'products'</b> não foi encontrado ou está vazio no Firebase.</p>
                    </div>`;
            }
        });
    }

    // 4. Renderização
    function renderProducts(list) {
        const grid = document.getElementById('product-grid');
        grid.innerHTML = list.map(p => `
            <div class="product-card p-4">
                <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden mb-4">
                    <img src="${p.image || 'https://via.placeholder.com/300'}" class="w-full h-full object-cover">
                </div>
                <h3 class="text-xs font-bold text-gray-800 h-8 overflow-hidden">${p.name}</h3>
                <p class="text-lg font-black mt-2 text-[#c5a059]">${fM(p.price || 0)}</p>
                <button class="w-full bg-black text-white text-[10px] py-2 mt-4 rounded-lg font-bold uppercase tracking-widest">Adicionar</button>
            </div>
        `).join('');
    }

    // 5. Filtro
    function filterCat(id) {
        const filtered = globalProducts.filter(p => p.category === id);
        renderProducts(filtered);
    }

    // Executa a carga
    forceLoad();
</script>
</body>
</html>
