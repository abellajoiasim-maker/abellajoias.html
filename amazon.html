<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abella Joias | Experiência de Compra Fluida</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Montserrat', sans-serif; background: #fff; color: #0F1111; scroll-behavior: smooth; }
        .amz-gold { background: #FFD814; border: 1px solid #FCD200; border-radius: 20px; }
        .amz-orange { background: #FFA41C; border: 1px solid #FF8F00; border-radius: 20px; }
        .buy-box { border: 1px solid #D5D9D9; border-radius: 8px; padding: 16px; background: white; }
        .zoom-container { position: relative; overflow: hidden; cursor: crosshair; }
        .zoom-container img { transition: transform 0.1s ease-out; }
        .hidden-section { display: none; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(10px); } to { opacity: 1; transform: translateX(0); } }
        .animate-slide { animation: slideIn 0.3s ease-out; }
    </style>
</head>
<body>

<header class="bg-[#131921] p-3 sticky top-0 z-[100]">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
        <h1 class="text-white text-xl font-bold cursor-pointer" onclick="irParaInicio()">ABELLA <span class="text-[#FF9900]">JOIAS</span></h1>
        <div class="text-white flex items-center gap-4">
            <div id="cart-info" class="flex items-center gap-1 cursor-pointer">
                <i class="fas fa-shopping-cart text-[#FF9900]"></i>
                <span id="cart-total" class="font-bold">R$ 0,00</span>
            </div>
        </div>
    </div>
</header>

<nav class="bg-[#f3f3f3] p-2 text-xs border-b">
    <div class="max-w-7xl mx-auto flex gap-2 text-gray-600" id="breadcrumb">
        <span class="cursor-pointer hover:underline" onclick="irParaInicio()">Loja</span>
    </div>
</nav>

<main class="max-w-7xl mx-auto p-4">
    <section id="sec-categorias" class="animate-slide">
        <h2 class="text-xl font-bold mb-6">Navegue por Coleções</h2>
        <div id="grid-categorias" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    </section>

    <section id="sec-produtos" class="hidden-section animate-slide">
        <div class="flex items-center gap-4 mb-6">
            <button onclick="irParaInicio()" class="text-sm text-blue-600 font-medium"><i class="fas fa-chevron-left"></i> Voltar</button>
            <h2 id="cat-title" class="text-xl font-bold">Produtos</h2>
        </div>
        <div id="grid-produtos" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    </section>

    <section id="sec-detalhe" class="hidden-section animate-slide"></section>
</main>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
        databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const fM = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

    let categoriaAtualNome = "";

    // --- CONTROLE DE NAVEGAÇÃO ---
    function mostrarSecao(id) {
        document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden-section'));
        document.getElementById(id).classList.remove('hidden-section');
        window.scrollTo(0,0);
    }

    function irParaInicio() {
        document.getElementById('breadcrumb').innerHTML = `<span onclick="irParaInicio()" class="cursor-pointer">Loja</span>`;
        mostrarSecao('sec-categorias');
    }

    // --- LOGICA DE CARREGAMENTO ---
    function carregarCategorias() {
        db.ref('categories').once('value', snap => {
            const grid = document.getElementById('grid-categorias');
            grid.innerHTML = '';
            snap.forEach(s => {
                const cat = s.val();
                grid.innerHTML += `
                    <div class="bg-white border rounded-lg cursor-pointer hover:shadow-md transition" onclick="irParaProdutos('${s.key}', '${cat.name}')">
                        <img src="${cat.image}" class="w-full aspect-square object-cover rounded-t-lg">
                        <p class="p-3 text-center font-bold text-sm">${cat.name}</p>
                    </div>`;
            });
        });
    }

    function irParaProdutos(id, nome) {
        categoriaAtualNome = nome;
        document.getElementById('cat-title').innerText = nome;
        document.getElementById('breadcrumb').innerHTML = `
            <span onclick="irParaInicio()" class="cursor-pointer">Loja</span> 
            <span>/</span> 
            <span class="font-bold">${nome}</span>`;
        
        const grid = document.getElementById('grid-produtos');
        grid.innerHTML = '<p class="col-span-full text-center py-10">Carregando...</p>';
        
        db.ref('products').once('value', snap => {
            grid.innerHTML = '';
            snap.forEach(s => {
                const p = s.val();
                if(p.category === id) {
                    grid.innerHTML += `
                        <div class="border p-3 cursor-pointer hover:shadow-sm" onclick='irParaDetalhe(${JSON.stringify({...p, id: s.key})})'>
                            <img src="${p.image}" class="w-full aspect-square object-contain mb-2">
                            <h3 class="text-xs text-gray-700 h-8 overflow-hidden">${p.name}</h3>
                            <p class="text-lg font-bold mt-2">${fM(p.price)}</p>
                        </div>`;
                }
            });
            mostrarSecao('sec-produtos');
        });
    }

    function irParaDetalhe(p) {
        document.getElementById('breadcrumb').innerHTML = `
            <span onclick="irParaInicio()" class="cursor-pointer">Loja</span> 
            <span>/</span> 
            <span onclick="mostrarSecao('sec-produtos')" class="cursor-pointer">${categoriaAtualNome}</span>
            <span>/</span>
            <span class="font-bold text-gray-400 text-xs">${p.name.substring(0,20)}...</span>`;

        const detalhe = document.getElementById('sec-detalhe');
        detalhe.innerHTML = `
            <div class="flex flex-col md:flex-row gap-8">
                <div class="md:w-1/2 zoom-container" id="zoom-box">
                    <img src="${p.image}" id="main-img-zoom" class="w-full object-contain max-h-[500px]">
                </div>
                <div class="flex-1">
                    <h1 class="text-2xl font-normal">${p.name}</h1>
                    <div class="flex text-[#F19D05] text-xs my-2">★★★★★ <span class="text-blue-600 ml-2 text-sm">850 avaliações</span></div>
                    <hr class="my-4">
                    <div class="text-3xl font-medium">${fM(p.price)}</div>
                    <p class="text-green-700 font-bold text-sm my-2">Em estoque.</p>
                    
                    <div class="buy-box mt-6">
                        <button onclick="addCart(${JSON.stringify(p)})" class="w-full amz-gold py-2 font-medium mb-3">Adicionar ao Carrinho</button>
                        <button onclick="finalizarWhatsApp('${p.name}', ${p.price})" class="w-full amz-orange py-2 font-medium">Comprar agora</button>
                        <p class="text-[10px] text-gray-500 mt-4 text-center"><i class="fas fa-lock"></i> Pagamento processado de forma segura</p>
                    </div>

                    <div class="mt-8">
                        <h3 class="font-bold text-sm">Descrição</h3>
                        <p class="text-sm text-gray-600 mt-2">Peça exclusiva banhada a Ouro 18k com tecnologia hipoalergênica. Acompanha certificado de garantia.</p>
                    </div>
                </div>
            </div>
        `;
        mostrarSecao('sec-detalhe');
        initZoom();
    }

    // --- UTILITARIOS ---
    function initZoom() {
        const box = document.getElementById('zoom-box');
        const img = document.getElementById('main-img-zoom');
        box.onmousemove = (e) => {
            const x = e.clientX - box.offsetLeft;
            const y = e.clientY - box.offsetTop;
            img.style.transformOrigin = `${x}px ${y}px`;
            img.style.transform = "scale(2)";
        };
        box.onmouseleave = () => img.style.transform = "scale(1)";
    }

    function addCart(p) {
        alert("Produto adicionado ao carrinho!");
        // Logica de carrinho aqui
    }

    function finalizarWhatsApp(nome, preco) {
        const fone = "5511999999999"; // Seu WhatsApp aqui
        const msg = encodeURIComponent(`Olá! Quero comprar o produto: ${nome} no valor de ${fM(preco)}`);
        window.open(`https://wa.me/${fone}?text=${msg}`, '_blank');
    }

    window.onload = carregarCategorias;
</script>
</body>
</html>
