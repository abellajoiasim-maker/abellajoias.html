<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gestão de Pedidos - Abella Joias</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; margin: 20px; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { color: #caa85c; border-bottom: 2px solid #caa85c; padding-bottom: 10px; }
        
        /* Barra de Busca */
        .search-bar { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; background: #fafafa; padding: 15px; border-radius: 5px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        
        /* Tabela */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #caa85c; color: white; padding: 12px; text-align: left; font-size: 13px; }
        td { padding: 10px; border-bottom: 1px solid #eee; font-size: 13px; }
        tr:hover { background: #fffcf5; }
        
        /* Botões de Ação */
        .btn-acao { padding: 5px 10px; margin: 2px; border: none; border-radius: 3px; cursor: pointer; font-size: 11px; font-weight: bold; }
        .btn-print { background: #3498db; color: white; }
        .btn-view { background: #2ecc71; color: white; }
        
        .status-badge { padding: 3px 8px; border-radius: 10px; font-size: 10px; background: #eee; }
    </style>
</head>
<body>

<div class="container">
    <h2>Gestão de Pedidos - Abella Joias</h2>

    <div class="search-bar">
        <input type="text" id="buscaNumero" placeholder="Nº do Pedido (Ex: 1001)" onkeyup="filtrar()">
        <input type="text" id="buscaCliente" placeholder="Nome do Cliente..." onkeyup="filtrar()">
        <input type="text" id="buscaTelefone" placeholder="Telefone..." onkeyup="filtrar()">
    </div>

    <table id="tabelaPedidos">
        <thead>
            <tr>
                <th style="width: 80px;">PEDIDO</th>
                <th>CLIENTE</th>
                <th>TELEFONE</th>
                <th>DATA</th>
                <th>TOTAL</th>
                <th style="text-align: center;">AÇÕES</th>
            </tr>
        </thead>
        <tbody id="listaCorpo">
            </tbody>
    </table>
</div>

<script>
    // CONFIGURAÇÃO DO FIREBASE (Cole a sua aqui)
    const firebaseConfig = { /* Sua Configuração */ };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let todosPedidos = [];

    // Carregar Pedidos do Banco
    function carregarPedidos() {
        db.ref('orders').orderByChild('timestamp').on('value', snapshot => {
            const corpo = document.getElementById('listaCorpo');
            corpo.innerHTML = "";
            todosPedidos = [];

            snapshot.forEach(child => {
                const p = child.val();
                p.idOriginal = child.key; // O UID do Firebase
                todosPedidos.push(p);
                
                renderizarLinha(p);
            });
        });
    }

    function renderizarLinha(p) {
        const corpo = document.getElementById('listaCorpo');
        const row = document.createElement('tr');
        
        row.innerHTML = `
            <td style="font-weight:bold; color:#caa85c;">#${p.numeroPedido || p.idOriginal.substring(0,5)}</td>
            <td>${p.cliente}</td>
            <td>${p.whatsapp || 'N/A'}</td>
            <td>${new Date(p.timestamp).toLocaleDateString()}</td>
            <td>R$ ${parseFloat(p.total).toFixed(2)}</td>
            <td style="text-align: center;">
                <button class="btn-acao btn-print" onclick="gerarRomaneio('${p.idOriginal}', 'completo')">COMPLETO</button>
                <button class="btn-acao btn-print" onclick="gerarRomaneio('${p.idOriginal}', 'simples')">SIMPLES</button>
                <button class="btn-acao btn-print" onclick="gerarRomaneio('${p.idOriginal}', 'foto')">C/ FOTO</button>
            </td>
        `;
        corpo.appendChild(row);
    }

    // Função de Busca em Tempo Real
    function filtrar() {
        const num = document.getElementById('buscaNumero').value.toLowerCase();
        const nome = document.getElementById('buscaCliente').value.toLowerCase();
        const tel = document.getElementById('buscaTelefone').value.toLowerCase();
        
        const corpo = document.getElementById('listaCorpo');
        corpo.innerHTML = "";

        const filtrados = todosPedidos.filter(p => {
            const matchNum = (p.numeroPedido || p.idOriginal).toString().toLowerCase().includes(num);
            const matchNome = p.cliente.toLowerCase().includes(nome);
            const matchTel = (p.whatsapp || "").includes(tel);
            return matchNum && matchNome && matchTel;
        });

        filtrados.forEach(p => renderizarLinha(p));
    }

    // Aqui você cola a sua função gerarRomaneio que criamos anteriormente
    function gerarRomaneio(id, tipo) {
        // ... (o código que já fizemos acima)
    }

    carregarPedidos();
</script>
</body>
</html>
