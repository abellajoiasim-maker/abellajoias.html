<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Abella Joias | CatÃ¡logo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{background:#F8F6F2}
.gold{color:#A68966}
.font-serif{font-family:'Cinzel',serif}
.floating{position:fixed;bottom:20px;right:20px;z-index:50}

/* Estilos do Modal de Quantidade */
#modalAdd { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; padding: 20px; }
.modal-content { background: white; padding: 30px; border-radius: 20px; max-width: 400px; width: 100%; text-align: center; border: 2px solid #A68966; }
.input-qty { border: 2px solid #A68966; padding: 12px; border-radius: 8px; width: 100px; text-align: center; font-size: 20px; font-weight: bold; margin: 10px 0; }
.btn-confirm { background: #000; color: #fff; width: 100%; padding: 15px; border-radius: 8px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; margin-top: 15px; }
.btn-cancel { color: #999; font-size: 12px; text-transform: uppercase; margin-top: 10px; cursor: pointer; }
select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; background: #fff; }
</style>
</head>

<body class="p-6">

<h1 class="font-serif text-3xl gold text-center mb-8">
Abella Joias<br>
<span class="text-sm tracking-widest">ATACADO DE JOIAS NO BRUTO</span>
</h1>

<div id="categorias" class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-6xl mx-auto"></div>

<div id="lista-produtos" class="hidden max-w-6xl mx-auto">
  <button onclick="voltarCategorias()" class="mb-6 text-gray-500 font-bold flex items-center gap-2">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
    Voltar para Categorias
  </button>
  <h2 id="titulo-categoria" class="font-serif text-2xl gold mb-6 uppercase tracking-wider"></h2>
  <div id="grid-produtos" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
</div>

<div id="modalAdd">
    <div class="modal-content shadow-2xl">
        <h3 id="m-nome" class="font-serif gold text-xl mb-1">Nome do Produto</h3>
        <p id="m-sku" class="text-[10px] text-gray-400 mb-6 uppercase tracking-widest"></p>
        
        <div id="area-variacao" class="hidden text-left mb-4">
            <label id="label-var" class="block text-[10px] font-bold uppercase text-gray-500 mb-1">Selecione a OpÃ§Ã£o:</label>
            <select id="m-variacao"></select>
        </div>

        <div>
            <label class="block text-[10px] font-bold uppercase text-gray-500 mb-1">Quantidade Atacado:</label>
            <input type="number" id="m-qty" value="1" min="1" class="input-qty">
        </div>

        <button onclick="confirmarAdicao()" class="btn-confirm shadow-lg">Adicionar ao Carrinho</button>
        <div onclick="fecharModal()" class="btn-cancel">Cancelar</div>
    </div>
</div>

<div class="floating flex flex-col gap-3">
  <a href="cart_checkout_premium.html" class="bg-black text-white px-6 py-4 rounded-full text-sm shadow-xl flex items-center gap-2">
    <span>ðŸ›’</span> <b>Carrinho</b>
  </a>
</div>

<script>
// Firebase Config
firebase.initializeApp({
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias"
});
const db = firebase.database();

let todosProdutos = [];
let itemSelecionado = null;

// Listas de VariaÃ§Ãµes
const LISTA_INICIAIS = "A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z".split(",");
const LISTA_DIZERES = ["Deus", "Jesus", "FÃ©", "GratidÃ£o", "AbenÃ§oada", "Paz", "Amor", "FamÃ­lia", "ForÃ§a"];

// Carrega os 1.396 produtos do banco
db.ref('products').once('value', snapshot => {
  const data = snapshot.val();
  if (data) {
    todosProdutos = Object.values(data);
    renderCategorias();
  }
});

function renderCategorias() {
  const cats = [...new Set(todosProdutos.map(p => p.categoria))].sort();
  const container = document.getElementById('categorias');
  container.innerHTML = cats.map(cat => `
    <div onclick="filtrar('${cat}')" class="bg-white p-6 border-b-4 border-[#A68966] text-center cursor-pointer shadow-sm hover:shadow-md transition group">
      <h3 class="font-serif gold uppercase tracking-wider group-hover:scale-110 transition duration-300 text-sm">${cat}</h3>
    </div>
  `).join('');
}

function filtrar(cat) {
  document.getElementById('categorias').classList.add('hidden');
  document.getElementById('lista-produtos').classList.remove('hidden');
  document.getElementById('titulo-categoria').innerText = cat;
  
  const filtrados = todosProdutos.filter(p => p.categoria === cat);
  const grid = document.getElementById('grid-produtos');
  
  grid.innerHTML = filtrados.map(p => `
    <div class="bg-white border p-3 shadow-sm flex flex-col rounded-lg">
      <div class="aspect-square bg-white flex items-center justify-center overflow-hidden mb-3">
        <img src="${p.imagem || 'https://via.placeholder.com/300'}" class="max-w-full max-h-full object-contain">
      </div>
      <h4 class="text-[11px] font-bold uppercase flex-1 leading-tight mb-1">${p.nome}</h4>
      <p class="text-[9px] text-gray-400 mb-2">${p.sku}</p>
      <p class="gold font-bold text-sm mb-3">R$ ${parseFloat(p.preco).toFixed(2)}</p>
      <button onclick='abrirModal(${JSON.stringify(p)})' class="bg-black text-white text-[10px] py-2 uppercase font-bold tracking-widest hover:bg-[#A68966] transition">
        Adicionar
      </button>
    </div>
  `).join('');
  window.scrollTo(0,0);
}

function voltarCategorias() {
  document.getElementById('categorias').classList.remove('hidden');
  document.getElementById('lista-produtos').classList.add('hidden');
}

// LÃ“GICA DO MODAL
function abrirModal(p) {
    itemSelecionado = p;
    document.getElementById('m-nome').innerText = p.nome;
    document.getElementById('m-sku').innerText = p.sku;
    document.getElementById('m-qty').value = 1;
    
    const areaVar = document.getElementById('area-variacao');
    const selectVar = document.getElementById('m-variacao');
    const labelVar = document.getElementById('label-var');
    
    areaVar.classList.add('hidden');
    selectVar.innerHTML = "";

    const nomeL = p.nome.toLowerCase();
    
    // Se for um produto de iniciais (A-Z)
    if (nomeL.includes("inicial") || nomeL.includes("letra")) {
        areaVar.classList.remove('hidden');
        labelVar.innerText = "Escolha a Letra:";
        LISTA_INICIAIS.forEach(l => {
            selectVar.innerHTML += `<option value="${l}">${l}</option>`;
        });
    } 
    // Se for um produto de frases (Dizeres)
    else if (nomeL.includes("dizeres") || nomeL.includes("frase") || nomeL.includes("escrito")) {
        areaVar.classList.remove('hidden');
        labelVar.innerText = "Escolha o Dizer:";
        LISTA_DIZERES.forEach(d => {
            selectVar.innerHTML += `<option value="${d}">${d}</option>`;
        });
    }

    document.getElementById('modalAdd').style.display = 'flex';
}

function fecharModal() {
    document.getElementById('modalAdd').style.display = 'none';
}

function confirmarAdicao() {
    const qty = parseInt(document.getElementById('m-qty').value);
    const variacao = document.getElementById('m-variacao').value;
    
    if (qty < 1 || isNaN(qty)) return alert("Digite uma quantidade vÃ¡lida.");

    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    
    // Verifica se jÃ¡ existe o mesmo produto com a mesma variaÃ§Ã£o no carrinho
    const index = cart.findIndex(i => i.sku === itemSelecionado.sku && i.variacao === (variacao || ""));

    if (index > -1) {
        cart[index].qty += qty;
    } else {
        cart.push({
            ...itemSelecionado,
            qty: qty,
            variacao: variacao || ""
        });
    }

    localStorage.setItem('cart', JSON.stringify(cart));
    fecharModal();
    
    // Feedback suave ao usuÃ¡rio
    const btnCart = document.querySelector('.floating b');
    btnCart.innerText = "Adicionado!";
    setTimeout(() => { btnCart.innerText = "Carrinho"; }, 2000);
}
</script>

</body>
</html>
