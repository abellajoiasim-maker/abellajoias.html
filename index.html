<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Abella Joias | Cat√°logo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{background:#F8F6F2}
.gold{color:#A68966}
.font-serif{font-family:'Cinzel',serif}
.floating{position:fixed;bottom:20px;right:20px;z-index:50}
/* Modal */
#modalAdd { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 100; align-items: center; justify-content: center; padding: 20px; }
.modal-content { background: white; padding: 25px; border-radius: 15px; max-width: 400px; width: 100%; text-align: center; }
.input-qty { border: 2px solid #A68966; padding: 10px; border-radius: 5px; width: 80px; text-align: center; font-size: 18px; font-weight: bold; }
</style>
</head>

<body class="p-6">

<h1 class="font-serif text-3xl gold text-center mb-8">
Abella Joias<br>
<span class="text-sm tracking-widest">ATACADO DE JOIAS NO BRUTO</span>
</h1>

<div id="categorias" class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-6xl mx-auto"></div>

<div id="lista-produtos" class="hidden max-w-6xl mx-auto">
  <button onclick="voltarCategorias()" class="mb-6 text-gray-500 font-bold">‚Üê Voltar para Categorias</button>
  <h2 id="titulo-categoria" class="font-serif text-2xl gold mb-6 uppercase"></h2>
  <div id="grid-produtos" class="grid grid-cols-2 md:grid-cols-4 gap-6"></div>
</div>

<div id="modalAdd">
    <div class="modal-content shadow-2xl">
        <h3 id="m-nome" class="font-serif gold text-xl mb-2">Nome do Produto</h3>
        <p id="m-sku" class="text-xs text-gray-400 mb-4"></p>
        
        <div id="area-variacao" class="mb-4 hidden text-left">
            <label id="label-var" class="block text-sm font-bold mb-1">Escolha uma op√ß√£o:</label>
            <select id="m-variacao" class="w-full border-2 border-gray-200 p-2 rounded-md"></select>
        </div>

        <div class="mb-6">
            <label class="block text-sm font-bold mb-1">Quantidade Atacado:</label>
            <input type="number" id="m-qty" value="1" min="1" class="input-qty">
        </div>

        <div class="flex gap-2">
            <button onclick="fecharModal()" class="flex-1 bg-gray-200 p-3 rounded-md font-bold">Cancelar</button>
            <button onclick="confirmarAdicao()" class="flex-1 bg-black text-white p-3 rounded-md font-bold">Adicionar</button>
        </div>
    </div>
</div>

<div class="floating flex flex-col gap-3">
  <a href="cart_checkout_premium.html" class="bg-black text-white px-4 py-3 rounded-full text-sm shadow-lg">üõí Carrinho</a>
</div>

<script>
// Firebase
firebase.initializeApp({
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias",
  storageBucket: "catalogo-abella-joias.appspot.com"
});
const db = firebase.database();

let todosProdutos = [];
let produtoAtualParaAdicionar = null;

// Listas de Varia√ß√µes
const LISTA_INICIAIS = "A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z".split(",");
const LISTA_DIZERES = ["Deus", "Jesus", "F√©", "Gratid√£o", "Aben√ßoada", "Paz", "Amor", "Fam√≠lia", "For√ßa"];

// Carrega Produtos
db.ref('products').once('value', snapshot => {
  const data = snapshot.val();
  if (data) {
    todosProdutos = Object.values(data);
    renderCategorias();
  }
});

function renderCategorias() {
  const cats = [...new Set(todosProdutos.map(p => p.categoria))].sort();
  const container = document.getElementById('categorias');
  container.innerHTML = cats.map(cat => `
    <div onclick="filtrar('${cat}')" class="bg-white p-6 border-b-4 border-[#A68966] text-center cursor-pointer shadow-sm hover:shadow-md transition">
      <h3 class="font-serif gold uppercase tracking-wider">${cat}</h3>
    </div>
  `).join('');
}

function filtrar(cat) {
  document.getElementById('categorias').classList.add('hidden');
  document.getElementById('lista-produtos').classList.remove('hidden');
  document.getElementById('titulo-categoria').innerText = cat;
  
  const filtrados = todosProdutos.filter(p => p.categoria === cat);
  const grid = document.getElementById('grid-produtos');
  
  grid.innerHTML = filtrados.map(p => `
    <div class="bg-white border p-4 shadow-sm flex flex-col">
      <img src="${p.imagem || 'https://via.placeholder.com/300'}" class="w-full aspect-square object-contain mb-4">
      <h4 class="text-sm font-bold flex-1">${p.nome}</h4>
      <p class="text-xs text-gray-400 mb-2">${p.sku}</p>
      <p class="gold font-bold mb-4">R$ ${parseFloat(p.preco).toFixed(2)}</p>
      <button onclick='abrirModal(${JSON.stringify(p)})' class="bg-black text-white text-xs py-2 uppercase tracking-widest hover:bg-gold transition">
        Adicionar
      </button>
    </div>
  `).join('');
}

function voltarCategorias() {
  document.getElementById('categorias').classList.remove('hidden');
  document.getElementById('lista-produtos').classList.add('hidden');
}

// L√ìGICA DO MODAL
function abrirModal(p) {
    produtoAtualParaAdicionar = p;
    document.getElementById('m-nome').innerText = p.nome;
    document.getElementById('m-sku').innerText = "SKU: " + p.sku;
    document.getElementById('m-qty').value = 1;
    
    const areaVar = document.getElementById('area-variacao');
    const selectVar = document.getElementById('m-variacao');
    const labelVar = document.getElementById('label-var');
    
    areaVar.classList.add('hidden');
    selectVar.innerHTML = "";

    // L√≥gica para detectar se precisa de Inicial ou Frase
    const nomeLower = p.nome.toLowerCase();
    
    if (nomeLower.includes("inicial") || nomeLower.includes("letra")) {
        areaVar.classList.remove('hidden');
        labelVar.innerText = "Selecione a Letra:";
        LISTA_INICIAIS.forEach(letra => {
            selectVar.innerHTML += `<option value="${letra}">${letra}</option>`;
        });
    } 
    else if (nomeLower.includes("dizeres") || nomeLower.includes("frase") || nomeLower.includes("escrito")) {
        areaVar.classList.remove('hidden');
        labelVar.innerText = "Selecione o Dizer:";
        LISTA_DIZERES.forEach(diz => {
            selectVar.innerHTML += `<option value="${diz}">${diz}</option>`;
        });
    }

    document.getElementById('modalAdd').style.display = 'flex';
}

function fecharModal() {
    document.getElementById('modalAdd').style.display = 'none';
}

function confirmarAdicao() {
    const qty = parseInt(document.getElementById('m-qty').value);
    const variacao = document.getElementById('m-variacao').value; // Pode ser vazio se hidden
    
    if (qty < 1) return alert("A quantidade deve ser pelo menos 1");

    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    
    // Identificador √∫nico considerando a varia√ß√£o (se houver)
    const itemIdx = cart.findIndex(item => item.sku === produtoAtualParaAdicionar.sku && item.variacao === variacao);

    if (itemIdx > -1) {
        cart[itemIdx].qty += qty;
    } else {
        cart.push({
            ...produtoAtualParaAdicionar,
            qty: qty,
            variacao: variacao || ""
        });
    }

    localStorage.setItem('cart', JSON.stringify(cart));
    fecharModal();
    alert(`Sucesso! ${qty} unidade(s) adicionada(s).`);
}
</script>

</body>
</html>
