<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>

<body class="bg-neutral-50">

<header class="p-6 bg-white border-b text-center">
  <h1 class="text-2xl font-serif">Abella Joias</h1>
</header>

<section class="max-w-6xl mx-auto p-6">
  <select id="filtroCategoria"
    class="border p-2 mb-6 w-full"
    onchange="filtrar()">
    <option value="">Todas as categorias</option>
  </select>

  <div id="produtos" class="grid sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
</section>

<footer class="fixed bottom-0 w-full bg-black text-white p-4 text-center">
  <button onclick="irCheckout()">ðŸ›’ Finalizar pedido</button>
</footer>

<script>
firebase.initializeApp({
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_PROJETO.firebaseapp.com",
  databaseURL: "https://SEU_PROJETO-default-rtdb.firebaseio.com",
  projectId: "SEU_PROJETO"
});

const db = firebase.database();
const lista = document.getElementById("produtos");
const filtro = document.getElementById("filtroCategoria");

let produtos = [];
let categorias = new Set();
let cart = JSON.parse(localStorage.getItem("cart")) || [];

db.ref("products").on("value", snap=>{
  produtos = [];
  categorias.clear();
  lista.innerHTML = "";
  filtro.innerHTML = `<option value="">Todas as categorias</option>`;

  snap.forEach(s=>{
    const p = s.val();
    p.id = s.key;
    produtos.push(p);
    if(p.category) categorias.add(p.category);
  });

  categorias.forEach(c=>{
    filtro.innerHTML += `<option>${c}</option>`;
  });

  render(produtos);
});

function render(arr){
  lista.innerHTML="";
  arr.forEach(p=>{
    lista.innerHTML+=`
    <div class="bg-white border p-4">
      <img src="${p.image}" class="h-48 w-full object-cover">
      <p class="mt-2 font-medium">${p.name}</p>
      <p class="text-xs">${p.category||''}</p>
      <p class="text-xs text-gray-400">Peso: ${p.weight||0}g</p>
      <p class="gold font-semibold">R$ ${p.price.toFixed(2)}</p>
      <button onclick='add(${JSON.stringify(p)})'
        class="bg-black text-white px-4 py-2 w-full mt-2">
        Comprar
      </button>
    </div>`;
  });
}

function filtrar(){
  if(!filtro.value) return render(produtos);
  render(produtos.filter(p=>p.category===filtro.value));
}

function add(p){
  const item = cart.find(i=>i.id===p.id);
  if(item) item.qty++;
  else cart.push({...p, qty:1});
  localStorage.setItem("cart", JSON.stringify(cart));
  alert("Adicionado ao carrinho");
}

function irCheckout(){
  window.location.href="checkout.html";
}
</script>

</body>
</html>
