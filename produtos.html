<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Abella Joias | Cat√°logo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
    /* ESTILOS DE ALTA PRIORIDADE */
    body { font-family: 'Poppins', sans-serif !important; background: #f8f6f2 !important; }
    .FONTE-TITULO { font-family: 'Cinzel', serif !important; color: #A68966 !important; text-transform: uppercase !important; }
    .LINHA-DIVISORA { height: 1px !important; background: #A68966 !important; width: 80px !important; margin: 15px auto !important; }
    
    /* ETIQUETA DE PESO ULTRA VIS√çVEL */
    .CAIXA-PESO { 
        background: #1a1a1a !important; 
        color: #ffffff !important; 
        font-size: 10px !important; 
        font-weight: 800 !important; 
        padding: 5px 12px !important; 
        border-radius: 6px !important; 
        display: inline-block !important;
        margin-bottom: 8px !important;
        letter-spacing: 1px !important;
    }

    .CARD-PRODUTO { background: #fff; border-radius: 20px; border: 1px solid #eee; padding: 15px; transition: 0.3s; position: relative; }
    .BOTAO-TOP { background: white; border: 1px solid #ddd; padding: 8px 16px; border-radius: 50px; font-size: 10px; font-weight: bold; }
</style>
</head>

<body>

<header class="bg-white border-b sticky top-0 z-50 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
        <button onclick="window.history.back()" class="BOTAO-TOP">‚Üê VOLTAR</button>
        <div class="text-center">
             <h1 class="FONTE-TITULO text-3xl md:text-4xl tracking-[0.2em]">Abella Joias</h1>
             <div class="LINHA-DIVISORA"></div>
             <p class="text-[9px] md:text-[10px] text-gray-500 uppercase tracking-[0.4em] font-medium">Atacado de Joias no Bruto</p>
        </div>
        <a href="checkout_premium.html" class="BOTAO-TOP">üõí <span id="cCount">0</span></a>
    </div>
</header>

<main class="max-w-7xl mx-auto p-4 md:p-8">
    <div id="grade-produtos" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-8"></div>
</main>

<script>
const firebaseConfig = { apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY", databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com" };
if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const slugURL = new URLSearchParams(window.location.search).get('cat');
let categoriasInfo = {};
let configPromo = {};

function init() {
    db.ref('settings/promocao').on('value', s => { configPromo = s.val() || {}; });
    db.ref('categories').on('value', s => { 
        s.forEach(c => { categoriasInfo[c.key] = c.val(); });
        renderizar();
    });
    updateCart();
}

function updateCart() {
    const c = JSON.parse(localStorage.getItem('carrinho') || '[]');
    document.getElementById('cCount').innerText = c.length;
}

function renderizar() {
    db.ref('products').orderByChild('category').equalTo(slugURL).on('value', snap => {
        const container = document.getElementById('grade-produtos');
        container.innerHTML = '';
        
        snap.forEach(sp => {
            const p = sp.val();
            if(p.paused) return;

            // Pre√ßo e Descontos
            const dCat = parseInt(categoriasInfo[p.category]?.discount || 0);
            const dGlob = configPromo.ativa ? parseInt(configPromo.porcentagem) : 0;
            const maiorDesc = Math.max(dCat, dGlob);
            const precoOriginal = parseFloat(p.price || 0);
            const precoFinal = maiorDesc > 0 ? precoOriginal * (1 - maiorDesc/100) : precoOriginal;

            // TEXTO DO PESO ATUALIZADO
            const pesoFormatado = p.weight ? `PESO: ${p.weight}g` : "PESO: --";

            container.innerHTML += `
                <div class="CARD-PRODUTO">
                    ${maiorDesc > 0 ? `<div class="absolute top-3 right-3 bg-red-600 text-white text-[9px] px-2 py-1 rounded-full font-bold animate-pulse z-10">${maiorDesc}% OFF</div>` : ''}
                    
                    <img src="${p.image}" class="w-full aspect-square object-cover rounded-xl mb-4">
                    
                    <span class="text-[8px] text-gray-400 font-bold uppercase tracking-widest">REF: ${p.sku || '---'}</span>
                    <h3 class="text-[11px] font-bold text-gray-800 leading-tight mb-3 h-8 overflow-hidden">${p.name}</h3>
                    
                    <div class="CAIXA-PESO">${pesoFormatado}</div>
                    <p class="text-[8px] text-gold font-bold uppercase italic mb-3">Linha Bruto Premium</p>

                    <div class="mt-auto border-t pt-3">
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-bold gold">R$ ${precoFinal.toFixed(2)}</span>
                            ${maiorDesc > 0 ? `<span class="text-[9px] text-gray-300 line-through">R$ ${precoOriginal.toFixed(2)}</span>` : ''}
                        </div>
                        <p class="text-[9px] text-green-600 font-bold mt-1 uppercase italic">R$ ${(precoFinal * 0.95).toFixed(2)} no PIX</p>
                    </div>

                    <button onclick="comprar('${sp.key}', ${precoFinal})" class="w-full bg-black text-white py-3 rounded-xl text-[10px] font-bold uppercase tracking-widest mt-3 hover:bg-[#A68966] transition-all shadow-md">
                        ADICIONAR
                    </button>
                </div>`;
        });
    });
}

function comprar(id, valor) {
    db.ref('products/' + id).once('value', s => {
        const item = s.val();
        let cart = JSON.parse(localStorage.getItem('carrinho') || '[]');
        cart.push({ nome: item.name, sku: item.sku, preco: valor, qtd: 1, image: item.image, peso: item.weight });
        localStorage.setItem('carrinho', JSON.stringify(cart));
        updateCart();
        alert("Adicionado ao pedido!");
    });
}

init();
</script>
</body>
</html>
