<!DOCTYPE html>
<html>
<head>
    <title>Importador Abella Joias</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
    <h2>Importar CSV para Firebase (Estrutura Corrigida)</h2>
    <input type="file" id="csvFile" accept=".csv">
    <button onclick="importar()">Enviar para o Banco</button>
    <div id="status"></div>

    <script>
        // COLE AQUI AS CONFIGURAÇÕES DO SEU PROJETO (Firebase Config)
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            databaseURL: "https://SEU_PROJETO.firebaseio.com",
            projectId: "SEU_PROJETO",
            storageBucket: "SEU_PROJETO.appspot.com",
            messagingSenderId: "ID",
            appId: "APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function importar() {
            const fileInput = document.getElementById('csvFile');
            const status = document.getElementById('status');
            
            if (!fileInput.files[0]) {
                alert("Selecione um arquivo CSV primeiro!");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const texto = e.target.result;
                const linhas = texto.split('\n');
                let contagem = 0;

                linhas.forEach((linha, index) => {
                    // Ignora cabeçalho ou linhas vazias
                    if (index === 0 && linha.toLowerCase().includes('tipo')) return;
                    if (linha.trim() === '') return;

                    const col = linha.split(';');

                    // MAPEAMENTO CORRIGIDO (8 COLUNAS)
                    const produto = {
                        tipo:      col[0] ? col[0].trim() : "simple",
                        nome:      col[1] ? col[1].trim() : "",
                        sku:       col[2] ? col[2].trim() : "",
                        categoria: col[3] ? col[3].trim() : "",
                        preco:     col[4] ? parseFloat(col[4].replace(',', '.')) : 0,
                        peso:      col[5] ? col[5].trim() : "0",
                        imagem:    col[6] ? col[6].trim() : "",
                        variacoes: col[7] ? col[7].trim().toUpperCase() === 'TRUE' : false
                    };

                    if (produto.sku) {
                        db.ref('products').push(produto);
                        contagem++;
                    }
                });
                status.innerHTML = "✅ " + contagem + " produtos enviados com sucesso!";
            };
            reader.readAsText(fileInput.files[0]);
        }
    </script>
</body>
</html>
